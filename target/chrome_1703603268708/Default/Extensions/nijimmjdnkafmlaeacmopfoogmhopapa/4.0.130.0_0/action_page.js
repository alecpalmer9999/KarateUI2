(()=>{"use strict";const e="forward",t="consoleLog",n="logToEventCollector",o="getExtensionDetails",i=(e,t)=>{if(t instanceof Error)try{const e={};return Object.getOwnPropertyNames(t).forEach((n=>{e[n]=t[n]})),e}catch(e){}return t};var r,s;!function(e){e[e.Background=1]="Background",e[e.ActiveTabTopContent=2]="ActiveTabTopContent",e[e.ActiveTabTopPage=3]="ActiveTabTopPage",e[e.AllContents=4]="AllContents",e[e.AllPages=5]="AllPages",e[e.OwnerContent=6]="OwnerContent",e[e.OwnedPage=7]="OwnedPage",e[e.OptionsPage=8]="OptionsPage",e[e.ActionPage=9]="ActionPage",e[e.SiblingContent=10]="SiblingContent",e[e.SiblingMediator=11]="SiblingMediator",e[e.Offscreen=12]="Offscreen"}(r||(r={})),function(e){e[e.Deny=0]="Deny",e[e.Accept=1]="Accept",e[e.Neutral=2]="Neutral"}(s||(s={}));const a=(e,t)=>{for(let n=0;n<e.length;n++){const o=e[n].getFilterResult(t);if(o==s.Deny)return!1;if(o==s.Accept)return!0}return!0};var c;!function(e){e[e.Silly=0]="Silly",e[e.Verbose=1]="Verbose",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(c||(c={}));const d="Communication",l=[],u=[],f=new class{constructor(e,t){this.appenders=e,this.logFilters=t,this.logsPerLevel=100,this.allLogs={},this.sendTimeByMessage={};for(const e in c){const t=Number(c[e]);this.allLogs[t]=[]}}getHistory(e){return this.allLogs[e]}log(e,t,n,o){const i={level:e,message:t,subject:o,data:n,time:Date.now()};a(this.logFilters,i)&&(this.addToLogHistory(i),this.appenders.map((e=>{try{e.log(i)}catch(e){}})))}addToLogHistory(e){for(const t in c){const n=Number(c[t]);if(n<=e.level){const t=this.allLogs[n];for(t.push(e);t.length>this.logsPerLevel;)t.splice(0,1)}}}silly(e,t,n){this.log(c.Silly,e,t,n)}verbose(e,t,n){this.log(c.Verbose,e,t,n)}trace(e,t,n){this.log(c.Verbose,e,t,n)}debug(e,t,n){this.log(c.Debug,e,t,n)}info(e,t,n){this.log(c.Info,e,t,n)}warn(e,t,n){this.log(c.Warn,e,t,n)}error(e,t,n){this.log(c.Error,e,t,n)}daily(e,t,n,o,i){this.limited(e,t,n,864e5,o,i)}limited(e,t,n,o,i,r){const s=Date.now(),a=this.sendTimeByMessage[n];void 0!==a&&s-a<o?this.log(t,n,i,r):(this.sendTimeByMessage[n]=s,this.log(e,n,i,r))}}(u,l),v={};v[t]=c.Verbose,v[n]=c.Verbose,v.getLibItems=c.Verbose,v[e]=c.Verbose,v.response=c.Verbose;const h=e=>new Promise((t=>{setTimeout((()=>t()),e)})),g=(e,t)=>new Promise(((n,o)=>{let i=!1,r=!1;e.then((e=>{i||(r=!0,n(e))})).catch((e=>{i||o(e)})),h(t).then((()=>{r||(i=!0,o("timeout"))}))}));class m{constructor(e){this.name=e}set(e){this.data=e}get(){if(void 0===this.data)throw`'${this.name} - data was not yet set`;return this.data}}const y=new m("sendMessageProvider"),p=(e,t)=>{return n=void 0,o=void 0,r=function*(){return y.get()(t,e)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}c((r=r.apply(n,o||[])).next())}));var n,o,i,r};var w=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};class x{constructor(e,t,n){var o,i,r;this.action=e,this.target=t,this.needsResponse=null===(o=null==n?void 0:n.needsResponse)||void 0===o||o,this.timeout=null!==(i=null==n?void 0:n.timeout)&&void 0!==i?i:3e3,this.autoRetry=null===(r=null==n?void 0:n.autoRetry)||void 0===r||r}createMessage(e){return{action:this.action,needsResponse:this.needsResponse,data:e}}send(e){var t;return w(this,void 0,void 0,(function*(){const n=null!==(t=v[this.action])&&void 0!==t?t:c.Debug;f.trace(`messageSender send was called for action ${this.action}`,e,d);const o=this.createMessage(e);f.log(n,`messageSender - sending message (${this.action})`,o,d);let i=0;for(;;)try{const e=p(o,this.target),t=yield g(e,this.timeout);return f.log(n,`messageSender - got result for message (${o.action})`,t,d),t}catch(e){if(!this.autoRetry){if(this.needsResponse)throw e;return}if(i++,i>5)throw f.debug(`messageSender failed for message (${o.action}), max retries reached.`,e,d),e;yield h(500),f.trace(`messageSender failed for message (${o.action}), retrying`,e,d)}throw"timeout"}))}}class b extends x{constructor(e,t,n){super(e,t,n)}send(e){const t=Object.create(null,{send:{get:()=>super.send}});return w(this,void 0,void 0,(function*(){return t.send.call(this,e)}))}}const P=new b(n,r.Background,{needsResponse:!1}),E=e=>{return t=void 0,n=void 0,r=function*(){if(e.data)try{e.data=(e=>{if(void 0===e)return e;const t=JSON.stringify(e,i);return JSON.parse(t)})(e.data)}catch(e){}P.send(e)},new((o=void 0)||(o=Promise))((function(e,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((r=r.apply(t,n||[])).next())}));var t,n,o,r},L=new x("getLoggerConfiguration",r.Background),k=()=>L.send();class T{constructor(e){this.subjectsToDeny=e}getFilterResult(e){return e.subject&&this.subjectsToDeny.indexOf(e.subject)>-1?s.Deny:s.Neutral}}const I=new m("currentExtensionPartProvider");class C{getFilterResult(e){return s.Deny}}class R{constructor(e){this.minLogLevel=e}getFilterResult(e){return e.level<this.minLogLevel?s.Deny:s.Neutral}}class B extends R{constructor(e){super(e),this.minLogLevel=e}getFilterResult(e){return"undefined"==typeof window||window==(null===window||void 0===window?void 0:window.top)?s.Neutral:super.getFilterResult(e)}}const O=["Content","Page","ContentMediator"],D=e=>{const t=[];e.enabled||t.push(new C);const n=I.get();return O.includes(n)&&t.push(new B(e.minIframeLogLevel)),t.push(new R(e.minTopLogLevel)),t};new b(t,r.ActiveTabTopContent,{autoRetry:!1,needsResponse:!1});const S=new m("logToConsoleProvider");var M=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const N=(...e)=>M(void 0,void 0,void 0,(function*(){console.log(...e)}));class A{constructor(e,t){this.logFilters=e,this.rateLimitEnforcer=t,this.didNotifyRateExceed=!1}handleRateLimitBlock(e){var t;if(this.didNotifyRateExceed)return;this.didNotifyRateExceed=!0;const n=((e,t)=>({level:c.Warn,message:"Rate limit blocked",time:e.time,data:{blockedLogMessage:e,rateLimit:t}}))(e,null===(t=this.rateLimitEnforcer)||void 0===t?void 0:t.rateLimit);this.logImpl(n)}log(e){a(this.logFilters,e)&&(!this.rateLimitEnforcer||this.rateLimitEnforcer.isAllowed()?this.logImpl(e):this.handleRateLimitBlock(e))}}class F extends A{constructor(){super(...arguments),this.currentLogs=[]}logImpl(e){return t=this,n=void 0,i=function*(){const t=e.subject?e.subject+" - ":"",n=`[${c[e.level]}]`;if(!this.currentLogs.includes(e.message)){this.currentLogs.push(e.message);try{const o=I.get();yield((...e)=>M(void 0,void 0,void 0,(function*(){const t=S.get();t&&(yield t(...e))})))(`${new Date(e.time).toISOString()} [${o}] - ${n} ${t}${e.message}`,e.data)}catch(e){}const o=this.currentLogs.indexOf(e.message);this.currentLogs.splice(o,1)}},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const W=new m("logToEventCollectorProvider");class $ extends A{logImpl(e){return t=this,n=void 0,i=function*(){const t=e;t.extensionPart=I.get();const n=W.get();n&&n(t)},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const H=new m("currentLoggerConfigProvider");class j{constructor(e){this.rateLimit=e,this.timesHistory=[]}addToHistory(e){for(this.timesHistory.push(e);this.timesHistory.length>this.rateLimit.maxTimesInInterval;)this.timesHistory.splice(0,1)}isAllowed(){const e=Date.now(),t=((e,t,n,o,i)=>e>=o&&void 0!==t&&n-t<i)(this.timesHistory.length,this.timesHistory[0],e,this.rateLimit.maxTimesInInterval,this.rateLimit.intervalInMs);return!t&&(this.addToHistory(e),!0)}}const V=e=>{if(e)return new j(e)},G=new m("currentMessageOriginProvider");let U;U="undefined"!=typeof chrome?chrome:browser;const _=U.runtime.sendMessage,z=(U.runtime.reload,U.runtime.onInstalled,(e,t)=>new Promise(((n,o)=>{const i=t;i.originPart=G.get(),e(i,(e=>{const t=U.runtime.lastError;t?o("Runtime last error: "+t.message):(null==e?void 0:e.success)?n(e.result):o(null==e?void 0:e.error)}))}))),J=e=>z(_,e);const K=(t,n)=>{return o=void 0,i=void 0,a=function*(){switch(t){case r.Background:return J(n);case r.OwnerContent:case r.OwnedPage:throw"can't send from action to "+t;default:{const i={action:e,data:{destination:t,message:o=n},needsResponse:o.needsResponse};return J(i)}}var o},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function r(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,r)}c((a=a.apply(o,i||[])).next())}));var o,i,s,a};var q;!function(e){e[e.TabError=1]="TabError",e[e.PageError=2]="PageError",e[e.LibError=3]="LibError",e[e.TimeOut=4]="TimeOut"}(q||(q={}));const Q=new x(o,r.Background,{timeout:1e3,autoRetry:!1});new x(o,r.Background,{timeout:1e3});let X;const Y="div",Z="p",ee="div-status-details-id",te="div-send-feedback-id",ne="h1-additional-details",oe="div-loaded-additional-details",ie="h1-customer-and-profile",re="div-customer-and-profile-id",se=(e,t,n,o)=>{const i=document.createElement(e);return i.id=t,i.className=n,i.textContent=o||i.textContent,i},ae=(e,t)=>{const n=document.getElementById("img-status-id"),o=document.getElementById("h1-status-id");n.src=e,n.className="img-status",o.innerText=t,o.className="h1-status-finished",X&&(ce(X.customer,X.profile),X.isExtensionDisabledFromOptions&&le())},ce=(e,t)=>{const n=se(Y,re,"div-customer-and-profile"),o=se(Z,"h1-customer-id",ie,e),i=se(Z,"h1-profile-id",ie,t);n.appendChild(o),n.appendChild(i),document.getElementById(ee).appendChild(n)},de=(e,t)=>{if(!e)return;const n=(()=>{const e=document.getElementById(te);if(e)return e;const t=se(Y,te,"div-send-feedback");return document.body.appendChild(t),t})(),o=se("a","","",t);o.href=e,o.onclick=e=>{e.preventDefault(),window.open(o.href)},n.appendChild(o)},le=()=>{const e=se(Z,"p-extension-disabled-id","p-extension-disabled","(Disabled from Options)");document.getElementById(re).appendChild(e)},ue=(e,t)=>{const n=se(Y,"div-additional-details-id",e);for(let e=0;e<t.length;e++)n.appendChild(t[e]);document.body.appendChild(n)},fe=()=>{const e=se("a","a-try-again-link-id","a-try-again-link","Click here to try again");e.href="http://",e.onclick=function(e){e.preventDefault(),location.reload()},document.getElementById(ee).appendChild(e)},ve=()=>{var e,t,n,o;if(!X)return;const i=null===(e=X.popupCustomization)||void 0===e?void 0:e.feedbackDataLink,r=(null===(t=X.popupCustomization)||void 0===t?void 0:t.feedbackLinkText)||"Send feedback",s=null===(n=X.popupCustomization)||void 0===n?void 0:n.moreInformationLink,a=(null===(o=X.popupCustomization)||void 0===o?void 0:o.moreInformationLinkText)||"More information";de(i,r),de(s,a)},he=e=>{let t="Failed to load WalkMe due to a time-out, please try to refresh the page";switch(e){case q.TabError:t="Failed to find current tab";break;case q.PageError:t="Page still loading",fe();break;case q.LibError:t="Lib is not ready yet",fe()}ae("./icons/not_running_illustration.png",t),ve()},ge=new x("getWalkMePageDetails",r.ActiveTabTopPage,{timeout:5e3,autoRetry:!1}),me=new b("getAvailablePublishEnvs",r.Background,{needsResponse:!0});var ye=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const pe=e=>U.storage[e||"sync"];var we=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const xe=new class{constructor(e){this.storageKey=e,this.didInit=!1,this.runningOperation=Promise.resolve()}get(){return we(this,void 0,void 0,(function*(){if(yield this.runningOperation,this.didInit)return this.data;const e=(t=this.storageKey,"local",new Promise((e=>{pe("local").get(t,(n=>{e(n?n[t]:"")}))}))).then((e=>{try{void 0!==e&&""!==e&&(this.data=JSON.parse(e))}catch(e){}return this.didInit=!0,this.data}));var t;return this.runningOperation=e,e}))}setOrClear(e){return we(this,void 0,void 0,(function*(){return void 0===e?this.clear():this.set(e)}))}set(e){return we(this,void 0,void 0,(function*(){yield this.runningOperation,this.data=e;const t=JSON.stringify(e),n=(o=this.storageKey,i=t,"local",ye(void 0,void 0,void 0,(function*(){const e={[o]:i};try{return yield pe("local").set(e),!0}catch(e){return!1}}))).finally();var o,i;return this.runningOperation=n,n}))}clear(){return we(this,void 0,void 0,(function*(){yield this.runningOperation,this.data=void 0;const e=(t=this.storageKey,"local",ye(void 0,void 0,void 0,(function*(){try{return yield pe("local").remove(t),!0}catch(e){return!1}}))).finally();var t;return this.runningOperation=e,e}))}}("wmExtBuilderMode");const be=(e,t,n)=>{return o=void 0,i=void 0,s=function*(){const o=se(Z,"end-user-id",ne,"User ID: "+e);let i="";"manual"==(null==X?void 0:X.installMode)?i=" (manual)":"forceNormal"==(null==X?void 0:X.installMode)&&(i=" (normal)");const r=[o,se(Z,"extension-version-id",ne,"Extension Version: "+X.version+i)];if(void 0!==(yield xe.get())){const e=yield((e,t)=>{return n=void 0,o=void 0,r=function*(){var n;const o=yield me.send(e);return null===(n=null==o?void 0:o.find((e=>e.Id==t)))||void 0===n?void 0:n.Name},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}c((r=r.apply(n,o||[])).next())}));var n,o,i,r})(t,n);if(e){const t=se(Z,"env-name",ne,"Environment: "+e);r.push(t)}}ae("./icons/success_illustartion.png","WalkMe Loaded Successfully"),ue(oe,r),ve()},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,a)}c((s=s.apply(o,i||[])).next())}));var o,i,r,s},Pe=new b("sendExtensionFailedStatusLog",r.Background);class Ee{static empty(){return"ffffffffffffffffffffffffffffffff"}static newGuid(){return Ee.newGuidByPattern("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static newGuidNoHyphens(){return Ee.newGuidByPattern("xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx")}static newGuidByPattern(e){return e.replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}const Le=e=>{return t=void 0,n=void 0,i=function*(){const t={id:Ee.newGuid(),extensionDetails:X,failReasons:e};yield Pe.send(t),((e,t)=>{const n=(e=>{const t=se("ul","ul-errors-id","ul-errors");for(const n of e){const e=se("li","li-error",n.id,n.reason);t.appendChild(e)}return t})(e),o=[n,(()=>{const e=se("a","a-test-page-link-id","a-test-page-link","Click here to open the connection test page");return e.href="https://cdn.walkme.com/General/EnvironmentTests/TestPage.html",e.onclick=t=>{t.preventDefault(),window.open(e.href)},e})(),se("h4","report-issue-text-id","h4-report-issue-text","We've reported this issue automatically issue id: "+t)];ae("./icons/fail_illustration.png","WalkMe Failed to Load"),ue("div-additional-details-errors",o),fe(),ve()})(e,t.id)},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i};const ke=new x("getExtensionShouldLoadDetails",r.Background,{timeout:2e3,autoRetry:!1}),Te=new x("getExtensionShouldLoadDecision",r.ActiveTabTopContent,{timeout:2e3,autoRetry:!1}),Ie=new x("getIsSnippetExistsAndShouldLoad",r.ActiveTabTopPage,{timeout:1e3,autoRetry:!1});var Ce=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const Re=e=>{const t=e.data;return e.fetchDataError?(he(e.fetchDataError),!1):!!t.shouldLoad||((e=>{const t=e.snippetExists?"WalkMe Snippet is Running on This Site":"WalkMe is Not Running on This Site",n=se(Z,"not-loading-reason-id",ne,e.reason);ae("./icons/not_running_illustration.png",t),ue(oe,[n]),ve()})(t),!1)},Be=new x("checkIfSettingsUrlExists",r.Background,{timeout:1e3,autoRetry:!1}),Oe=new x("canCurrentSettingsFileBeFetched",r.Background,{timeout:1e3,autoRetry:!1});var De=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const Se={id:"settings-url-does-not-exists",reason:"Settings file url was not defined"},Me={id:"settings-file-can-not-load-id",reason:"Failed to load settings file, please check the test page below"};const Ne=new class{start(){return e=this,t=void 0,o=function*(){try{if(!(yield De(void 0,void 0,void 0,(function*(){const e=yield De(void 0,void 0,void 0,(function*(){try{return yield Be.send()}catch(e){return!1}}));return e||Le([Se]),e}))))return;if(yield(e=void 0,t=void 0,n=void 0,o=function*(){X=yield Q.send()},new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))),!(yield De(void 0,void 0,void 0,(function*(){const e=yield Oe.send();return e||Le([Me]),e}))))return;if(!(yield Ce(void 0,void 0,void 0,(function*(){const e=yield ke.send();return Re(e)}))))return;if(!(yield Ce(void 0,void 0,void 0,(function*(){const e=yield Te.send();return Re(e)}))))return;if(!(yield Ce(void 0,void 0,void 0,(function*(){const e=yield Ie.send();return Re(e)}))))return;!function(e,t,n,o){new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){const e=yield ge.send(),t=e.data;if(e.fetchDataError)return he(e.fetchDataError);const n=(e=>{const t=[];return e.endUserId||t.push({id:"end-user-error-id",reason:"User ID was not detected"}),e.walkmeRemoveReason&&t.push({id:"walkme-remove-reason-id",reason:"WalkMe remove reason: "+e.walkmeRemoveReason}),t})(t);if(0==n.length)return be(t.endUserId,t.loadedGuid,t.loadedEnv);Le(n)}))}catch(e){he(q.TimeOut)}var e,t,n,o},new((n=void 0)||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}},Ae=new x("getPublishEnvOverride",r.Background,{needsResponse:!0}),Fe=new x("reloadWebsite",r.ActiveTabTopContent,{needsResponse:!1}),We=new b("setPublishEnvOverride",r.Background,{needsResponse:!1});var $e=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const He="env-change-select",je="env-change-reload-link",Ve="env-change-explanation",Ge=()=>$e(void 0,void 0,void 0,(function*(){yield Fe.send(),window.close()})),Ue=e=>{const t=document.getElementById(He).value,n=parseInt(t);if(isNaN(n))return;const o=-1!=n?n:void 0;We.send(o);const i=document.getElementById(je);document.getElementById(Ve).style.display="none",i.style.display="inline-block",i.classList.remove("text-blink"),requestAnimationFrame((()=>{i.classList.add("text-blink")}))},_e=(e,t,n,o)=>{const i=document.createElement("option");i.innerText=n,i.value=t.toString(),i.selected=o,e.appendChild(i)};var ze,Je;Je=function*(){var e,t,n,o,i;yield(e={extensionPart:"ActionPage",fetchLogConfig:k,logToEventCollector:E,sendMessageFunction:K},t=void 0,n=void 0,o=void 0,i=function*(){var t;I.set(e.extensionPart),G.set(null!==(t=e.messageOrigin)&&void 0!==t?t:e.extensionPart),y.set(e.sendMessageFunction),(e=>{H.set(e);const t=D(e.console),n=V(e.console.rateLimit),o=new F(t,n),i=D(e.remote);i.push(new T([d]));const r=V(e.remote.rateLimit),s=[o,new $(i,r)];var a;a=[],l.length=0,a.map((e=>l.push(e))),(e=>{u.length=0,e.map((e=>u.push(e)))})(s)})(yield e.fetchLogConfig()),W.set(e.logToEventCollector),S.set(e.logToConsole||N)},new(o||(o=Promise))((function(e,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}))),Ne.start(),$e(void 0,void 0,void 0,(function*(){var e,t,n;const o=yield xe.get();if(void 0===o)return;const i=yield Ie.send(),r=null===(t=null===(e=null==i?void 0:i.data)||void 0===e?void 0:e.injectedPackage)||void 0===t?void 0:t.UserGuid;let s=[];if(r&&(s=yield me.send(r)),!r||!s||0==s.length)return;const a="elevated"==o;document.getElementById("env-change").style.display="block";const c=null!==(n=yield Ae.send())&&void 0!==n?n:-1;((e,t)=>{const n=e.find((e=>e.Id==t)),o=n?`${n.Name} environment will be used`:"Environment will not be overriden";document.getElementById(Ve).innerText=o})(s,c),yield((e,t,n)=>$e(void 0,void 0,void 0,(function*(){const o=document.getElementById(He);_e(o,-1," - Default - ",-1==t),e.forEach((e=>{if(!e.IsDev||n||e.Id==t){const n=e.Id==t;_e(o,e.Id,e.Name,n)}}))})))(s,c,a),document.getElementById(He).onchange=Ue,document.getElementById(je).addEventListener("click",Ge)}))},new((ze=void 0)||(ze=Promise))((function(e,t){function n(e){try{i(Je.next(e))}catch(e){t(e)}}function o(e){try{i(Je.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof ze?i:new ze((function(e){e(i)}))).then(n,o)}i((Je=Je.apply(void 0,[])).next())}))})();