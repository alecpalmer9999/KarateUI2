(()=>{"use strict";const e="forward",t="consoleLog",n="logToEventCollector",o="raiseEvent";var i;!function(e){e[e.Deny=0]="Deny",e[e.Accept=1]="Accept",e[e.Neutral=2]="Neutral"}(i||(i={}));const s=(e,t)=>{for(let n=0;n<e.length;n++){const o=e[n].getFilterResult(t);if(o==i.Deny)return!1;if(o==i.Accept)return!0}return!0};var r;!function(e){e[e.Silly=0]="Silly",e[e.Verbose=1]="Verbose",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(r||(r={}));const c="Communication",a=[],u=[],d=new class{constructor(e,t){this.appenders=e,this.logFilters=t,this.logsPerLevel=100,this.allLogs={},this.sendTimeByMessage={};for(const e in r){const t=Number(r[e]);this.allLogs[t]=[]}}getHistory(e){return this.allLogs[e]}log(e,t,n,o){const i={level:e,message:t,subject:o,data:n,time:Date.now()};s(this.logFilters,i)&&(this.addToLogHistory(i),this.appenders.map((e=>{try{e.log(i)}catch(e){}})))}addToLogHistory(e){for(const t in r){const n=Number(r[t]);if(n<=e.level){const t=this.allLogs[n];for(t.push(e);t.length>this.logsPerLevel;)t.splice(0,1)}}}silly(e,t,n){this.log(r.Silly,e,t,n)}verbose(e,t,n){this.log(r.Verbose,e,t,n)}trace(e,t,n){this.log(r.Verbose,e,t,n)}debug(e,t,n){this.log(r.Debug,e,t,n)}info(e,t,n){this.log(r.Info,e,t,n)}warn(e,t,n){this.log(r.Warn,e,t,n)}error(e,t,n){this.log(r.Error,e,t,n)}daily(e,t,n,o,i){this.limited(e,t,n,864e5,o,i)}limited(e,t,n,o,i,s){const r=Date.now(),c=this.sendTimeByMessage[n];void 0!==c&&r-c<o?this.log(t,n,i,s):(this.sendTimeByMessage[n]=r,this.log(e,n,i,s))}}(u,a);var l=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};class h{constructor(e,t,n){this.action=e,this.allowedOrigins=t,this.blockedOrigins=n}handle(e,t){return l(this,void 0,void 0,(function*(){if(d.trace("messageHandler handle called",e,c),e.action!=this.action)throw"unsupported action: "+e.action+", expected: "+this.action;return this.handleImpl(t)}))}}class f{constructor(e,t,n){this.action=e,this.allowedOrigins=t,this.blockedOrigins=n}handle(e,t){return l(this,void 0,void 0,(function*(){if(d.trace("messageHandler handle called",e,c),e.action!=this.action)throw"unsupported action: "+e.action+", expected: "+this.action;const n=e.data;return this.handleImpl(n,t)}))}}class v{constructor(e){this.name=e}set(e){this.data=e}get(){if(void 0===this.data)throw`'${this.name} - data was not yet set`;return this.data}}const g=new v("sendMessageProvider"),m=(e,t)=>{return n=void 0,o=void 0,s=function*(){return g.get()(t,e)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s};class w extends f{constructor(){super(e)}handleImpl(e){return t=this,n=void 0,i=function*(){const t=p(e);return m(t,e.destination)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const p=e=>e.message,y=(t,n)=>({action:e,data:{destination:t,message:n},needsResponse:n.needsResponse});var x;let b;!function(e){e[e.Background=1]="Background",e[e.ActiveTabTopContent=2]="ActiveTabTopContent",e[e.ActiveTabTopPage=3]="ActiveTabTopPage",e[e.AllContents=4]="AllContents",e[e.AllPages=5]="AllPages",e[e.OwnerContent=6]="OwnerContent",e[e.OwnedPage=7]="OwnedPage",e[e.OptionsPage=8]="OptionsPage",e[e.ActionPage=9]="ActionPage",e[e.SiblingContent=10]="SiblingContent",e[e.SiblingMediator=11]="SiblingMediator",e[e.Offscreen=12]="Offscreen"}(x||(x={})),b="undefined"!=typeof chrome?chrome:browser;const P=b.runtime.sendMessage,L=(b.runtime.reload,b.runtime.onInstalled,new v("currentMessageOriginProvider")),M="response",S={};S[t]=r.Verbose,S[n]=r.Verbose,S.getLibItems=r.Verbose,S[e]=r.Verbose,S[M]=r.Verbose;const k=e=>new Promise((t=>{setTimeout((()=>t()),e)})),R=(e,t)=>new Promise(((n,o)=>{let i=!1,s=!1;e.then((e=>{i||(s=!0,n(e))})).catch((e=>{i||o(e)})),k(t).then((()=>{s||(i=!0,o("timeout"))}))}));var C=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};class T{constructor(e,t,n){var o,i,s;this.action=e,this.target=t,this.needsResponse=null===(o=null==n?void 0:n.needsResponse)||void 0===o||o,this.timeout=null!==(i=null==n?void 0:n.timeout)&&void 0!==i?i:3e3,this.autoRetry=null===(s=null==n?void 0:n.autoRetry)||void 0===s||s}createMessage(e){return{action:this.action,needsResponse:this.needsResponse,data:e}}send(e){var t;return C(this,void 0,void 0,(function*(){const n=null!==(t=S[this.action])&&void 0!==t?t:r.Debug;d.trace(`messageSender send was called for action ${this.action}`,e,c);const o=this.createMessage(e);d.log(n,`messageSender - sending message (${this.action})`,o,c);let i=0;for(;;)try{const e=m(o,this.target),t=yield R(e,this.timeout);return d.log(n,`messageSender - got result for message (${o.action})`,t,c),t}catch(e){if(!this.autoRetry){if(this.needsResponse)throw e;return}if(i++,i>5)throw d.debug(`messageSender failed for message (${o.action}), max retries reached.`,e,c),e;yield k(500),d.trace(`messageSender failed for message (${o.action}), retrying`,e,c)}throw"timeout"}))}}class O extends T{constructor(e,t,n){super(e,t,n)}send(e){const t=Object.create(null,{send:{get:()=>super.send}});return C(this,void 0,void 0,(function*(){return t.send.call(this,e)}))}}const I=new T("checkShouldRestoreCommunicationOnUpdate",x.Background);var E=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};class H{constructor(e){this.name=e,this.wasSet=!1}set(e){d.debug(`${this.name} - getAsync - setting data`,e),this.data=e,this.wasSet=!0,this.resolveFunc&&(this.resolveFunc(e),this.resolveFunc=void 0,this.resolvePromise=void 0)}get(){return E(this,void 0,void 0,(function*(){return this.wasSet?(d.trace(`${this.name} - getAsync - data already available`,this.data),this.data):(this.resolvePromise||(d.debug(`${this.name} - getAsync - creating promise`),this.resolvePromise=new Promise((e=>{this.resolveFunc=e}))),this.resolvePromise)}))}getSync(){return{wasSet:this.wasSet,data:this.data}}}const D=new class{constructor(e){this.getLogic=e,this.wasSet=!1}get(){return E(this,void 0,void 0,(function*(){if(!this.wasSet)try{const e=yield this.getLogic();this.data=e,this.wasSet=!0}catch(e){}return this.data}))}}((()=>{return e=void 0,t=void 0,o=function*(){try{return I.send()}catch(e){return!1}},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o})),N=new v("contentToMediatorMessageSenderProvider");var B=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};const j=e=>B(void 0,void 0,void 0,(function*(){if((()=>{var e;try{return!!(null===(e=null==b?void 0:b.runtime)||void 0===e?void 0:e.id)}catch(e){return!1}})())return A(e);if(yield D.get())return $(e);throw"cannot communicate with background"})),A=e=>((e,t)=>new Promise(((n,o)=>{const i=t;i.originPart=L.get(),e(i,(e=>{const t=b.runtime.lastError;t?o("Runtime last error: "+t.message):(null==e?void 0:e.success)?n(e.result):o(null==e?void 0:e.error)}))})))(P,e),$=e=>B(void 0,void 0,void 0,(function*(){return(e=>N.get().send(e))(y(x.Background,e))})),F=new H("contentLoadDecisionProvider"),W=new H("contentToPageMessageSenderProvider");const V=(e,t)=>{return n=void 0,o=void 0,s=function*(){switch(e){case x.Background:return j(t);case x.OwnedPage:return(e=>{return t=void 0,n=void 0,i=function*(){if((yield F.get()).shouldLoad)return(yield W.get()).send(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i})(t);default:{const n=y(e,t);return j(n)}}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s},_=(e,t)=>{t.map((t=>{try{e.addMessageHandler(t)}catch(e){}}))};new O(t,x.ActiveTabTopContent,{autoRetry:!1,needsResponse:!1});const U=new v("logToConsoleProvider");var q=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};const G=(...e)=>q(void 0,void 0,void 0,(function*(){console.log(...e)}));const z=new class extends f{constructor(){super(t)}handleImpl(e){return t=this,n=void 0,i=function*(){G(...e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}},J=e=>{const t=e.match(/\/walkme_([a-f0-9]+)(_https)?.js/);if(t)return t[1]},K=e=>{const t=e.src;if(t)return J(t)},Q=e=>{const t=e.innerHTML;if(!(t.length>350))return J(t)},X=e=>{var t;return(e=>{for(const t of e){const e=K(t);if(e)return e}for(const t of e){const e=Q(t);if(e)return e}})((t=e.document,Array.from(t.getElementsByTagName("script"))))};var Y;!function(e){e[e.TabError=1]="TabError",e[e.PageError=2]="PageError",e[e.LibError=3]="LibError",e[e.TimeOut=4]="TimeOut"}(Y||(Y={}));const Z="UrlNotWhiteListed";const ee=new class extends h{constructor(){super("getExtensionShouldLoadDecision")}getNoLoadReason(e,t){if(!e)return t.noLoadReason===Z?"This site is not whitelisted in the extension":"Extension is not configured to run on this site"}handleImpl(){return e=this,t=void 0,o=function*(){try{let t,n;const o=yield F.get();return o.shouldLoad||(n=!!function(e){return!!e._walkmeInternals}(e=window)||!!X(e),t=this.getNoLoadReason(n,o)),{data:{shouldLoad:o.shouldLoad,reason:t,snippetExists:n}}}catch(e){return{fetchDataError:Y.PageError}}var e},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}};class te{constructor(e){this.subjectsToDeny=e}getFilterResult(e){return e.subject&&this.subjectsToDeny.indexOf(e.subject)>-1?i.Deny:i.Neutral}}const ne=new v("currentExtensionPartProvider");class oe{getFilterResult(e){return i.Deny}}class ie{constructor(e){this.minLogLevel=e}getFilterResult(e){return e.level<this.minLogLevel?i.Deny:i.Neutral}}class se extends ie{constructor(e){super(e),this.minLogLevel=e}getFilterResult(e){return"undefined"==typeof window||window==(null===window||void 0===window?void 0:window.top)?i.Neutral:super.getFilterResult(e)}}const re=["Content","Page","ContentMediator"],ce=e=>{const t=[];e.enabled||t.push(new oe);const n=ne.get();return re.includes(n)&&t.push(new se(e.minIframeLogLevel)),t.push(new ie(e.minTopLogLevel)),t};class ae{constructor(e,t){this.logFilters=e,this.rateLimitEnforcer=t,this.didNotifyRateExceed=!1}handleRateLimitBlock(e){var t;if(this.didNotifyRateExceed)return;this.didNotifyRateExceed=!0;const n=((e,t)=>({level:r.Warn,message:"Rate limit blocked",time:e.time,data:{blockedLogMessage:e,rateLimit:t}}))(e,null===(t=this.rateLimitEnforcer)||void 0===t?void 0:t.rateLimit);this.logImpl(n)}log(e){s(this.logFilters,e)&&(!this.rateLimitEnforcer||this.rateLimitEnforcer.isAllowed()?this.logImpl(e):this.handleRateLimitBlock(e))}}class ue extends ae{constructor(){super(...arguments),this.currentLogs=[]}logImpl(e){return t=this,n=void 0,i=function*(){const t=e.subject?e.subject+" - ":"",n=`[${r[e.level]}]`;if(!this.currentLogs.includes(e.message)){this.currentLogs.push(e.message);try{const o=ne.get();yield((...e)=>q(void 0,void 0,void 0,(function*(){const t=U.get();t&&(yield t(...e))})))(`${new Date(e.time).toISOString()} [${o}] - ${n} ${t}${e.message}`,e.data)}catch(e){}const o=this.currentLogs.indexOf(e.message);this.currentLogs.splice(o,1)}},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const de=new v("logToEventCollectorProvider");class le extends ae{logImpl(e){return t=this,n=void 0,i=function*(){const t=e;t.extensionPart=ne.get();const n=de.get();n&&n(t)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const he=new v("currentLoggerConfigProvider");class fe{constructor(e){this.rateLimit=e,this.timesHistory=[]}addToHistory(e){for(this.timesHistory.push(e);this.timesHistory.length>this.rateLimit.maxTimesInInterval;)this.timesHistory.splice(0,1)}isAllowed(){const e=Date.now(),t=((e,t,n,o,i)=>e>=o&&void 0!==t&&n-t<i)(this.timesHistory.length,this.timesHistory[0],e,this.rateLimit.maxTimesInInterval,this.rateLimit.intervalInMs);return!t&&(this.addToHistory(e),!0)}}const ve=e=>{if(e)return new fe(e)},ge=e=>{he.set(e);const t=ce(e.console),n=ve(e.console.rateLimit),o=new ue(t,n),i=ce(e.remote);i.push(new te([c]));const s=ve(e.remote.rateLimit),r=[o,new le(i,s)];var d;d=[],a.length=0,d.map((e=>a.push(e))),(e=>{u.length=0,e.map((e=>u.push(e)))})(r)};const me=new class extends f{constructor(){super("updateLoggerConfig")}handleImpl(e){return t=this,n=void 0,i=function*(){ge(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}};const we=new class extends h{constructor(){super("reloadWebsite")}handleImpl(){return e=this,t=void 0,o=function*(){window.location.reload()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}};class pe{constructor(e,t){this.registerToMessages=e,this.router=t}start(){this.registerToMessages(((e,t,n)=>this.handleNativeMessage(e,t,n)))}handleNativeMessage(e,t,n){d.trace("handleNativeMessage",e,c);const o=(e=>({tabId:e.tab?e.tab.id:void 0,tabUrl:e.tab?e.tab.url:void 0,frameId:e.frameId}))(t);return this.router.handleMessage(e,n,o)}}const ye=e=>{b.runtime.onMessage.addListener(e)},xe=[z,ee,me,we],be=(e,t,n)=>{let o;const i=e=>{o(e.detail)},s=(t,n)=>{const o=(i={data:n},"undefined"!=typeof cloneInto?cloneInto(i,e):i);var i;const s=new CustomEvent(t,{detail:o});e.dispatchEvent(s)};return{postMessage:e=>{s(n,e)},postToSelf:e=>{s(t,e)},registerOnMessage:n=>{e.removeEventListener(t,i),n&&(o=n,e.addEventListener(t,i))},unregister:()=>{e.removeEventListener(t,i)}}},Pe=e=>null==e?void 0:e.data,Le=e=>e.message;class Me extends f{constructor(e,t){super(e),this.handler=t}handleImpl(e,t){return this.handler(e,t)}}class Se{static empty(){return"ffffffffffffffffffffffffffffffff"}static newGuid(){return Se.newGuidByPattern("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static newGuidNoHyphens(){return Se.newGuidByPattern("xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx")}static newGuidByPattern(e){return e.replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}let ke=0;const Re=`testListenerAlive.${Se.newGuidNoHyphens()}`,Ce=(e,t)=>new Promise((n=>{const o=`${Re}.${ke++}`;((e,t,n)=>{const o=new Me(e,(o=>{return i=void 0,s=void 0,c=function*(){clearTimeout(o),t.removeMessageHandler(e),n(!0)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function o(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,o)}a((c=c.apply(i,s||[])).next())}));var i,s,r,c}));t.addMessageHandler(o)})(o,e,n);const i=setTimeout((()=>{e.removeMessageHandler(o),n(!1)})),s=((e,t)=>({action:e,data:t,needsResponse:!1}))(o,i);t.send(s,!0)}));class Te{constructor(e){this.handleEvent=e}handle(e){this.handleEvent(e)}canHandle(e){return(e=>{const t=Pe(e);if(!t)return!1;const n=Le(t);return!!n&&!!n.action})(e)}}class Oe{constructor(e){this.communicationObject=e,this.communicationMessageHandlers=[]}start(){this.communicationObject.registerOnMessage((e=>this.handleMessageEvent(e)))}stop(){this.communicationObject.unregister()}reRegisterCommunication(){this.communicationObject.registerOnMessage((e=>this.handleMessageEvent(e)))}addCommunicationMessageHandler(e){this.communicationMessageHandlers.push(e)}handleMessageEvent(e){this.communicationMessageHandlers.map((t=>{try{t.canHandle(e)&&t.handle(e)}catch(n){d.debug("failed handling event",{event:e,handler:t,exception:n},c)}}))}}class Ie{constructor(e,t,n,o){this.responder=e,this.selfSender=t,this.messageRouter=n,this.communicationObject=o,this.communicationObjectConnector=new Oe(this.communicationObject)}start(){this.communicationObjectConnector.start();const e=new Te((e=>this.handleRegularRoutingMessage(e)));this.addCommunicationMessageHandler(e)}stop(){this.communicationObjectConnector.stop()}verifyCommunication(){return e=this,t=void 0,o=function*(){(yield Ce(this.messageRouter,this.selfSender))||this.communicationObjectConnector.reRegisterCommunication()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}addCommunicationMessageHandler(e){this.communicationObjectConnector.addCommunicationMessageHandler(e)}handleRegularRoutingMessage(e){const t=Pe(e),n=Le(t);d.trace("CommunicationObjectMessageRouter - handling event",e,c),this.messageRouter.handleMessage(n,(e=>{this.sendResponse(t,e)}))}sendResponse(e,t){this.responder.sendResponse(e,t)}}class Ee{constructor(e,t){this.postMessageFn=e,this.responseMessageHandler=t,this.runningMessageId=0}send(e,t=!1){return n=this,o=void 0,s=function*(){d.trace("CommunicationObjectMessageSender send called",e,c);const n=e;n.originPart=L.get();const o=this.createCommunictionObjectMessage(n);if(d.trace("CommunicationObjectMessageSender send wrapped message",o,c),!t)return new Promise(((e,t)=>{this.responseMessageHandler.waitForResponse(o.id,e,t),this.sendRaw(o)}));this.sendRaw(o)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s}sendResponse(e,t){var n;if((null===(n=e.message)||void 0===n?void 0:n.action)==M)return;const o={messageId:e.id,resultData:t},i={action:M,needsResponse:!1,data:o,originPart:L.get()};this.send(i,!0)}sendRaw(e){if(d.trace("CommunicationObjectMessageSender sendSync",e),!this.postMessageFn)throw"postMessageFn object wasn't initialized";this.postMessageFn(e)}createCommunictionObjectMessage(e){return{id:e.action+(new Date).getTime()+"_"+this.runningMessageId++,message:e}}}const He=M;class De extends f{constructor(){super(He),this.pendingRequests={}}handleImpl(e){return t=this,n=void 0,i=function*(){if(void 0===this.pendingRequests[e.messageId])return;const t=this.pendingRequests[e.messageId];delete this.pendingRequests[e.messageId],e.resultData.success?t.resolve(e.resultData.result):t.reject(e.resultData.error)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}waitForResponse(e,t,n){this.pendingRequests[e]={resolve:t,reject:n}}}const Ne=(e,t)=>{const n=t.getMessageHandler(He),o=null!=n?n:new De;n||t.addMessageHandler(o);const i=new Ee(e.postMessage,o),s=new Ee(e.postToSelf,o),r=new Ie(i,s,t,e);return r.start(),{routerConnector:r,sender:i,selfSender:s}};class Be{constructor(e){this.doc=e,this.callbacks=[],this.observer=new MutationObserver((e=>{e.some((e=>Array.from(e.removedNodes).some((e=>e.toString().includes("DocumentType")))))&&this.runRegisteredCallbacks()}))}runRegisteredCallbacks(){this.callbacks.forEach((e=>{try{e()}catch(e){}}))}start(){this.observer.disconnect(),this.observer.observe(this.doc,{childList:!0})}stop(){this.observer.disconnect()}addListener(e){this.removeListener(e),this.callbacks.push(e)}removeListener(e){this.callbacks=this.callbacks.filter((t=>e!=t))}}let je;const Ae=(e,t)=>{je||(je=new Be(e),je.start()),je.addListener(t)},$e=new T("changeActionPageIconColor",x.Background,{needsResponse:!1});const Fe=new class extends h{constructor(){super("mediatorStarted")}handleImpl(){return e=this,t=void 0,o=function*(){(yield F.get()).shouldLoad&&$e.send()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}},We=e=>!(!e||e.length<=0)&&e.some((e=>{var t;return!!(null===(t=e.Configuration)||void 0===t?void 0:t.rebindCommunicationOnDocumentWrite)}));const Ve=new class extends h{constructor(){super("checkShouldRestoreCommunicationOnDocumentWrite")}handleImpl(){return e=this,t=void 0,o=function*(){const e=yield F.get();return!!e.shouldLoad&&We(e.relevantPackages)},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}};const _e=[Fe,Ve],Ue=(e,t)=>{F.get().then((n=>{n.shouldLoad&&We(n.relevantPackages)&&Ae(e.document,(()=>t.routerConnector.verifyCommunication()))}))},qe=new v("contentScriptStartTimeProvider"),Ge=new class{constructor(e){this.logger=e}getAllLogs(e=r.Debug){return this.logger.getHistory(e)}getLogger(){return this.logger}}(d);class ze{constructor(){this.log=Ge}}class Je{constructor(e){this.messageRouter=e}onMessage(e,t){const n=new Me(e,t);this.messageRouter.addMessageHandler(n)}sendMessage(e,t,n,o){const i={needsResponse:!1,autoRetry:null==o?void 0:o.autoRetry,timeout:null==o?void 0:o.timeout};new O(e,t,i).send(n)}sendMessageWithResult(e,t,n,o){const i={needsResponse:!0,autoRetry:null==o?void 0:o.autoRetry,timeout:null==o?void 0:o.timeout};return new O(e,t,i).send(n)}}const Ke=e=>b.runtime.getURL(e),Qe=["head"],Xe=(e,t,n)=>{e="string"==typeof e||e instanceof String?[e]:e;const o=et(t);o.src=n,o.onload=()=>{o.remove()},tt(e,o)},Ye=(e,t,n)=>{e="string"==typeof e||e instanceof String?[e]:e;const o=et(t);o.onload=()=>{o.remove()},o.appendChild(document.createTextNode(n)),tt(e,o)},Ze=(e,t)=>{Xe(Qe,"walkme-extension-web-accessible-script-"+e,t)},et=e=>{const t=document.createElement("script");return t.id=e,t.type="text/javascript",t},tt=(e,t)=>{const n=e.map(nt).filter(ot);n&&n[0]&&n[0][0].appendChild(t)},nt=e=>document.getElementsByTagName(e),ot=e=>e.length>0;class it{constructor(){this.injectUrlScript=Xe,this.injectTextScript=Ye}}const st=new T("getSystemId",x.OwnedPage);var rt=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};const ct=(e,t)=>{const n={communication:new Je(t),scriptInjector:new it,logger:d,createExtensionUrl:Ke,getLoadDecision:()=>rt(void 0,void 0,void 0,(function*(){return F.get()})),page:{getSystemId:()=>rt(void 0,void 0,void 0,(function*(){return i=window,e=void 0,t=void 0,o=function*(){try{return(yield F.get()).shouldLoad?st.send():X(i)}catch(e){return}},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o,i}))}};return e.__walkMeContentSdk=n,n};class at{constructor(e){this.name=e,this.epoch=(new Date).getTime(),this.previousEventTime=this.epoch}silly(e,t){this.log(e,r.Silly,t)}verbose(e,t){this.log(e,r.Verbose,t)}trace(e,t){this.log(e,r.Verbose,t)}debug(e,t){this.log(e,r.Debug,t)}info(e,t){this.log(e,r.Info,t)}log(e,t,n){const o=(new Date).getTime(),i=o-this.epoch,s=Math.round(performance.now()),r=o-this.previousEventTime;this.previousEventTime=o;const c=`${this.name} - ${e}`,a={timeSinceLoggerStarted:i,timeSincePageLoad:s,timeSincePreviousEvent:r},u=Object.assign({},a,n);d.log(t,c,u,"Performance")}}const ut=(e,t)=>{return n=void 0,o=void 0,s=function*(){return((t,n)=>{return o=void 0,i=void 0,r=function*(){return new Promise((t=>{const o=()=>{e.head?t():setTimeout(o,n)};o()}))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,c)}a((r=r.apply(o,i||[])).next())}));var o,i,s,r})(0,t=t||10)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s},dt=["text/xml","application/xml","application/pdf"],lt=e=>e!==e.top,ht=e=>{if(!lt(e))return!1;try{if(e.parent.location.href)return!1}catch(e){return!0}return!0},ft=new T("checkIsEditorAlive",x.Background);const vt=new O("checkIsUrlWhiteListed",x.Background,{autoRetry:!1,timeout:1e4});const gt=e=>{return t=void 0,n=void 0,i=function*(){return t=e.document,-1!=dt.indexOf(t.contentType)?mt("WrongContentType"):(e=>lt(e)&&!ht(e))(e)?mt("SameDomainIframe"):(yield(n=void 0,o=void 0,i=void 0,s=function*(){return!!(yield ft.send())},new(i||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}))))?mt("EditorAlive"):(yield(r=e.location.href,function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){return!!(yield vt.send(r))}))))?{shouldLoad:!0}:mt(Z);var t,n,o,i,s,r},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i};function mt(e){return{shouldLoad:!1,noLoadReason:e}}const wt=new O("getRelevantPackages",x.Background,{autoRetry:!1,timeout:1e4});let pt;const yt=()=>pt,xt=["https://account.walkme.com","https://eu-account.walkme.com","https://account.walkmeqa.com","https://account2.walkmedev.com","https://account.walkmedev.com","http://localhost:51619"];const bt=e=>{return t=void 0,n=void 0,i=function*(){const t=yield gt(e);if(!t.shouldLoad)return Pt(t.noLoadReason);const n=(e=>{const t={};t.url=e.location.href;const n=(o=e.location).protocol+"//"+o.host;var o,i;return t.isWalkMeDomain=!!(i=n)&&xt.some((e=>i===e)),t.size={height:e.innerHeight,width:e.innerWidth},lt(e)?t.iframe={crossDomain:ht(e)}:t.topFrame=!0,t})(e),o=yield(a=n,i=void 0,s=void 0,r=void 0,c=function*(){return pt||(pt=yield wt.send(a)),pt},new(r||(r=Promise))((function(e,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function o(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,o)}a((c=c.apply(i,s||[])).next())})));var i,s,r,c,a;return o.length>0?Lt(o):Pt("NoMatchingPackage")},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i},Pt=e=>({noLoadReason:e,shouldLoad:!1,relevantPackages:[]}),Lt=e=>({relevantPackages:e,shouldLoad:!0});var Mt;!function(e){e[e.DocumentSnippetBlocking=0]="DocumentSnippetBlocking",e[e.WalkMeLoading=1]="WalkMeLoading"}(Mt||(Mt={}));const St=new class extends h{constructor(){super("getPackages")}handleImpl(){return e=this,t=void 0,o=function*(){return yt()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}};var kt=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};const Rt=new class extends h{constructor(){super("getLanguage")}handleImpl(){return kt(this,void 0,void 0,(function*(){const e={};if(!document.body||!document.body.innerText||!b.i18n)return e;const t=yield this.getLanguageFromPage();for(let n=0;n<t.languages.length;n++)e[t.languages[n].language]=t.languages[n].percentage;return e}))}getLanguageFromPage(){return kt(this,void 0,void 0,(function*(){return new Promise((e=>{b.i18n.detectLanguage(document.body.innerText,(t=>{e(t)}))}))}))}},Ct=new T("getNonceValue",x.Background),Tt=/'nonce-(.*?)'/;const Ot=new H("nonceValueProvider"),It=e=>{return t=void 0,n=void 0,i=function*(){let t;yt().some((e=>e.UseNonceFromMetaTag))&&(t=(e=>{let t;try{const n=e.querySelectorAll("meta[http-equiv='Content-Security-Policy']");for(const e of n)if(e&&e.content){const n=e.content.split(";").find((e=>e.includes("script-src")));if(n){const e=n.match(Tt);if(e&&e.length>0){t=e[1];break}}}}catch(e){d.error(`Meta tag error: ${e}`)}return t})(e.document)),t||(t=yield Ct.send()),Ot.set(t)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i};const Et=new class extends h{constructor(){super("getNonceValue")}handleImpl(){return e=this,t=void 0,o=function*(){return Ot.get()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}};const Ht=new class extends h{constructor(){super("getContentStartTime")}handleImpl(){return e=this,t=void 0,o=function*(){return qe.get()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}},Dt={};Dt.Page=x.OwnerContent,Dt.Content=x.Background;const Nt=(e,t)=>{const n=(e=>{if(void 0!==Dt[e])return Dt[e]})(ne.get());var i;void 0!==n&&(i={eventName:e,eventData:t},new O(o,n,void 0).send(i))};var Bt=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};const jt=new class{constructor(){this.subscribersByEventName={}}on(e,t){return void 0===this.subscribersByEventName[e]&&(this.subscribersByEventName[e]=[]),this.subscribersByEventName[e].push(t),()=>{this.off(e,t)}}off(e,t){if(void 0===this.subscribersByEventName[e])return;const n=this.subscribersByEventName[e],o=n.indexOf(t);-1!=o&&(n.splice(o,1),0==n.length&&delete this.subscribersByEventName[e])}raiseEvent(e,t,n){return Bt(this,void 0,void 0,(function*(){return this.handleBubbling(e,t),this.handleRaise(e,t,n)}))}handleBubbling(e,t){try{Nt(e,t)}catch(e){}}handleRaise(e,t,n){return Bt(this,void 0,void 0,(function*(){if(void 0===this.subscribersByEventName[e])return;const o=this.subscribersByEventName[e];for(let e=0;e<o.length;e++){const i=o[e];try{const e=i(t,n);e&&e.promiseToWait&&(yield e.promiseToWait)}catch(e){}}}))}};const At=[St,Et,Ht,new class extends f{constructor(){super(o)}handleImpl(e,t){return n=this,o=void 0,s=function*(){const n={tabId:null==t?void 0:t.tabId};return jt.raiseEvent(e.eventName,e.eventData,n)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s}},Rt];const $t=()=>{return e=void 0,t=void 0,o=function*(){var e,t,n,o;Ft()&&(yield(e=void 0,t=void 0,n=void 0,o=function*(){const e=Ke("walkme_snippet_blocking_web_accessible.js");Ze(Mt.DocumentSnippetBlocking,e)},new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))))},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o},Ft=()=>!0;var Wt,Vt;!function(e){e[e.NoSnippetInSite=0]="NoSnippetInSite",e[e.SnippetInSite=1]="SnippetInSite",e[e.AutoDetect=2]="AutoDetect",e[e.SnippetInSiteTimeout=3]="SnippetInSiteTimeout"}(Wt||(Wt={})),function(e){e[e.OnlyTop=1]="OnlyTop",e[e.TopAndCdIframes=2]="TopAndCdIframes"}(Vt||(Vt={}));const _t=e=>e.SnippetDetect!=Wt.NoSnippetInSite;const Ut=(e,t)=>{return n=void 0,o=void 0,s=function*(){const n=yield e;n.shouldLoad&&n.relevantPackages.some(_t)&&(yield t,$t())},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}));var n,o,i,s};var qt=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))};class Gt{constructor(e,t){var n;this.win=e,this.contentMessagesRouter=t,this.currentHost=e.location.host,this.timingHelper=(n=`content runner - ${this.currentHost}`,new at(n))}start(){return qt(this,void 0,void 0,(function*(){const e=this.getLoadingDecision(),t=this.waitForDocumentLoad();yield this.handleSiteSnippetBlocking(e,t),this.timingHelper.trace("after handleSiteSnippetBlocking");const n=yield e;if(d.debug(`Load decision, should load: ${n.shouldLoad}`,n),this.saveLoadingDecision(n),n.shouldLoad){yield t,yield this.setNonceValue(),this.timingHelper.trace("after set nonce value"),this.changeActionPageIconColor(),this.timingHelper.trace("after changing action window icon");const e=We(n.relevantPackages);yield this.registerPageCommunication(this.win,this.contentMessagesRouter,e),this.timingHelper.trace("after creating communication iframe"),yield this.injectWebAccessibleWalkMeLoadingScript();const o={host:this.currentHost,injectedPackages:n.relevantPackages};this.timingHelper.info("after injecting web accessible resources",o)}else yield this.handleNoLoad(n)}))}registerPageCommunication(e,t,n){return qt(this,void 0,void 0,(function*(){const o=(e=>be(e,"wmPageToContent","wmContentToPage"))(e),i=Ne(o,t);n&&Ae(e.document,(()=>i.routerConnector.verifyCommunication())),(e=>{_(e,At)})(t),W.set(i.sender)}))}waitForDocumentLoad(){return qt(this,void 0,void 0,(function*(){this.timingHelper.trace("before wait for document load");const e=ut(document);yield e,this.timingHelper.trace("after wait for document load")}))}injectWebAccessibleWalkMeLoadingScript(){return qt(this,void 0,void 0,(function*(){return e=void 0,t=void 0,o=function*(){const e=Ke("walkme_loading_web_accessible.js");Ze(Mt.WalkMeLoading,e)},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o}))}handleSiteSnippetBlocking(e,t){return qt(this,void 0,void 0,(function*(){return Ut(e,t)}))}getLoadingDecision(){return qt(this,void 0,void 0,(function*(){this.timingHelper.trace("before get load decision");const e=yield bt(this.win);return this.timingHelper.trace("after get load decision"),e}))}saveLoadingDecision(e){F.set(e)}changeActionPageIconColor(){$e.send()}setNonceValue(){return It(this.win)}handleNoLoad(e){return qt(this,void 0,void 0,(function*(){}))}}class zt{constructor(e=!1){this.ignoreUnhandledMessages=e,this.events={}}handleMessage(e,t,n){var o;const i=null!==(o=S[e.action])&&void 0!==o?o:r.Debug;if(d.log(i,`MessageRouter - handleMessage (${e.action})`,e,c),!e.action)return d.debug(`message ${e} has no action, ignoring.`),!1;const s=this.events[e.action],a=this.checkCanHandle(e,s);return a.canHandle?(s.handle(e,n).then((n=>{d.log(i,`MessageRouter - done handling (${e.action})`,n,c),t&&t({success:!0,result:n})})).catch((e=>{t&&t({success:!1,error:e})})),!0):(!this.ignoreUnhandledMessages&&t&&t({success:!1,error:a.reason}),!1)}addMessageHandler(e){if(this.events[e.action])throw`action ${e.action} was already registered`;this.events[e.action]=e}getMessageHandler(e){return this.events[e]}removeMessageHandler(e){delete this.events[e]}checkCanHandle(e,t){return t?this.isOriginBlockedForHandler(e,t)?(d.debug(`blocked message ${e.action} from ${e.originPart} due to blocked origin`),{canHandle:!1,reason:"origin not allowed"}):this.isOriginAllowedForHandler(e,t)?{canHandle:!0}:(d.debug(`blocked message ${e.action} from ${e.originPart} due to not allowed origin`),{canHandle:!1,reason:"origin not allowed"}):(d.debug(`message ${e.action} from ${e.originPart} has no handler`),{canHandle:!1,reason:"unknown action: "+e.action})}isOriginBlockedForHandler(e,t){return!(!t.blockedOrigins||!t.blockedOrigins.length)&&!(void 0!==e.originPart&&!t.blockedOrigins.includes(e.originPart))}isOriginAllowedForHandler(e,t){return!t.allowedOrigins||!t.allowedOrigins.length||!(void 0===e.originPart||!t.allowedOrigins.includes(e.originPart))}}const Jt=(e,t)=>{if(t instanceof Error)try{const e={};return Object.getOwnPropertyNames(t).forEach((n=>{e[n]=t[n]})),e}catch(e){}return t};const Kt=new O(n,x.Background,{needsResponse:!1}),Qt=e=>{return t=void 0,n=void 0,i=function*(){if(e.data)try{e.data=(e=>{if(void 0===e)return e;const t=JSON.stringify(e,Jt);return JSON.parse(t)})(e.data)}catch(e){}Kt.send(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i},Xt=new T("getLoggerConfiguration",x.Background),Yt=()=>Xt.send();var Zt,en;en=function*(){const e=Date.now();var t,n,o,i,s;qe.set(e),yield(t={extensionPart:"Content",fetchLogConfig:Yt,logToEventCollector:Qt,sendMessageFunction:V},n=void 0,o=void 0,i=void 0,s=function*(){var e;ne.set(t.extensionPart),L.set(null!==(e=t.messageOrigin)&&void 0!==e?e:t.extensionPart),g.set(t.sendMessageFunction);const n=yield t.fetchLogConfig();ge(n),de.set(t.logToEventCollector),U.set(t.logToConsole||G)},new(i||(i=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((s=s.apply(n,o||[])).next())}))),d.debug("WalkMe Loading - Content Script started, init took: ",Date.now()-e);const r=new zt;_(r,[new w]),(e=>{new pe(ye,e).start(),_(e,xe)})(r),((e,t)=>{!function(e,t,n,o){new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){try{(yield D.get())&&((e,t)=>{_(t,_e);const n=(e=>be(e,"wmMediatorToContent","wmContentToMediator"))(e),o=Ne(n,t);N.set(o.sender),Ue(e,o)})(e,t)}catch(e){}}))})(window,r),ct(window,r),window._wmExtensionApi=new ze,new Gt(window,r).start(),d.debug("WalkMe Loading - End of Content script")},new((Zt=void 0)||(Zt=Promise))((function(e,t){function n(e){try{i(en.next(e))}catch(e){t(e)}}function o(e){try{i(en.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof Zt?i:new Zt((function(e){e(i)}))).then(n,o)}i((en=en.apply(void 0,[])).next())}))})();