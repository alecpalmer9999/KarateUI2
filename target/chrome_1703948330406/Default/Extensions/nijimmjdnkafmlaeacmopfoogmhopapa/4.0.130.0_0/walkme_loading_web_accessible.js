(()=>{"use strict";var e;!function(e){e[e.Deny=0]="Deny",e[e.Accept=1]="Accept",e[e.Neutral=2]="Neutral"}(e||(e={}));const t=(t,n)=>{for(let o=0;o<t.length;o++){const i=t[o].getFilterResult(n);if(i==e.Deny)return!1;if(i==e.Accept)return!0}return!0};var n;!function(e){e[e.Silly=0]="Silly",e[e.Verbose=1]="Verbose",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(n||(n={}));const o="Communication",i="Monitor",s=[],r=[],a=new class{constructor(e,t){this.appenders=e,this.logFilters=t,this.logsPerLevel=100,this.allLogs={},this.sendTimeByMessage={};for(const e in n){const t=Number(n[e]);this.allLogs[t]=[]}}getHistory(e){return this.allLogs[e]}log(e,n,o,i){const s={level:e,message:n,subject:i,data:o,time:Date.now()};t(this.logFilters,s)&&(this.addToLogHistory(s),this.appenders.map((e=>{try{e.log(s)}catch(e){}})))}addToLogHistory(e){for(const t in n){const o=Number(n[t]);if(o<=e.level){const t=this.allLogs[o];for(t.push(e);t.length>this.logsPerLevel;)t.splice(0,1)}}}silly(e,t,o){this.log(n.Silly,e,t,o)}verbose(e,t,o){this.log(n.Verbose,e,t,o)}trace(e,t,o){this.log(n.Verbose,e,t,o)}debug(e,t,o){this.log(n.Debug,e,t,o)}info(e,t,o){this.log(n.Info,e,t,o)}warn(e,t,o){this.log(n.Warn,e,t,o)}error(e,t,o){this.log(n.Error,e,t,o)}daily(e,t,n,o,i){this.limited(e,t,n,864e5,o,i)}limited(e,t,n,o,i,s){const r=Date.now(),a=this.sendTimeByMessage[n];void 0!==a&&r-a<o?this.log(t,n,i,s):(this.sendTimeByMessage[n]=r,this.log(e,n,i,s))}}(r,s),c="setLibItem",u="removeLibItem",l="removeLibItems",d="storageNotify";var h,v;let f;!function(e){e[e.Silly=0]="Silly",e[e.Verbose=1]="Verbose",e[e.Debug=2]="Debug",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(h||(h={})),function(e){e[e.Background=1]="Background",e[e.ActiveTabTopContent=2]="ActiveTabTopContent",e[e.ActiveTabTopPage=3]="ActiveTabTopPage",e[e.AllContents=4]="AllContents",e[e.AllPages=5]="AllPages",e[e.OwnerContent=6]="OwnerContent",e[e.OwnedPage=7]="OwnedPage",e[e.OptionsPage=8]="OptionsPage",e[e.ActionPage=9]="ActionPage"}(v||(v={}));const g=()=>f;const m=(e,t)=>{return n=void 0,o=void 0,s=function*(){const n={key1:e,key2:t};return{value:yield g().communication.sendMessageWithResult("getLibItem",v.Background,n)}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s};const p=e=>{return t=void 0,n=void 0,i=function*(){return{values:yield g().communication.sendMessageWithResult("getLibItems",v.Background,e)}},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i},w=[],y=e=>(w.push(e),()=>{const t=w.indexOf(e);t>-1&&w.splice(t,1)});let x=!1;const b=e=>{x&&g().communication.sendMessage(d,v.AllPages,e)};const k=(e,t)=>{return n=void 0,o=void 0,s=function*(){const n={key1:e,key2:t},o=yield g().communication.sendMessageWithResult(u,v.Background,n);return o&&b({action:u,key1:e,key2:t}),{success:o}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s};const P=e=>{return t=void 0,n=void 0,i=function*(){const t=yield g().communication.sendMessageWithResult(l,v.Background,e);return t&&b({action:l,key1:e}),{success:t}},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i};const M=(e,t,n)=>{return o=void 0,i=void 0,r=function*(){const o={key:{key1:e,key2:t},value:n},i=yield g().communication.sendMessageWithResult(c,v.Background,o);return i&&b({action:c,key1:e,key2:t,value:n}),{success:i}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,a)}c((r=r.apply(o,i||[])).next())}));var o,i,s,r};const S=(e,t)=>{try{const o={getLibItem:m,getLibItems:p,setLibItem:M,removeLibItem:k,removeLibItems:P,onNotifyStorageAction:y,isEnvironmentPartitioningSupported:!0};n=!!(null==t?void 0:t.notifyOtherPages),x=n,e.pageDataExposer.exposeWalkMeExtension("storage",o),L(e)}catch(e){}var n},L=e=>{e.communication.onMessage(d,(e=>{return t=void 0,n=void 0,i=function*(){(e=>{w.forEach((t=>{try{t(e)}catch(e){}}))})(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}))};class E{init(e){return t=this,n=void 0,i=function*(){((e,t)=>{try{f=e,e.eventsManager.on("snippetInject",(n=>{S(e,t)}))}catch(e){}})(e,{notifyOtherPages:!1})},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const I="snippetInject";var R;!function(e){e[e.Background=1]="Background",e[e.ActiveTabTopContent=2]="ActiveTabTopContent",e[e.ActiveTabTopPage=3]="ActiveTabTopPage",e[e.AllContents=4]="AllContents",e[e.AllPages=5]="AllPages",e[e.OwnerContent=6]="OwnerContent",e[e.OwnedPage=7]="OwnedPage",e[e.OptionsPage=8]="OptionsPage",e[e.ActionPage=9]="ActionPage",e[e.SiblingContent=10]="SiblingContent",e[e.SiblingMediator=11]="SiblingMediator",e[e.Offscreen=12]="Offscreen"}(R||(R={}));class T{init(e){return t=this,n=void 0,i=function*(){e.eventsManager.on(I,(t=>((e,t)=>({promiseToWait:t.communication.sendMessageWithResult("getIsIdpEnabled",R.Background).then((e=>{e&&(e=>{e.pageDataExposer.exposeWalkMeExtension("isExtensionIdpEnabled",!0),e.pageDataExposer.exposeWalkMeInternals("getExtensionIdp",((t,n)=>((e,t,n)=>{const o={uid:e,env:t};return n.communication.sendMessageWithResult("getIdpResult",R.Background,o)})(t,n,e)))})(t)}))}))(0,e)))},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const O="forward",C="consoleLog",D="logToEventCollector",A="getExtensionDetails",B="response",H={};H[C]=n.Verbose,H[D]=n.Verbose,H.getLibItems=n.Verbose,H[O]=n.Verbose,H[B]=n.Verbose;class W{constructor(e=!1){this.ignoreUnhandledMessages=e,this.events={}}handleMessage(e,t,i){var s;const r=null!==(s=H[e.action])&&void 0!==s?s:n.Debug;if(a.log(r,`MessageRouter - handleMessage (${e.action})`,e,o),!e.action)return a.debug(`message ${e} has no action, ignoring.`),!1;const c=this.events[e.action],u=this.checkCanHandle(e,c);return u.canHandle?(c.handle(e,i).then((n=>{a.log(r,`MessageRouter - done handling (${e.action})`,n,o),t&&t({success:!0,result:n})})).catch((e=>{t&&t({success:!1,error:e})})),!0):(!this.ignoreUnhandledMessages&&t&&t({success:!1,error:u.reason}),!1)}addMessageHandler(e){if(this.events[e.action])throw`action ${e.action} was already registered`;this.events[e.action]=e}getMessageHandler(e){return this.events[e]}removeMessageHandler(e){delete this.events[e]}checkCanHandle(e,t){return t?this.isOriginBlockedForHandler(e,t)?(a.debug(`blocked message ${e.action} from ${e.originPart} due to blocked origin`),{canHandle:!1,reason:"origin not allowed"}):this.isOriginAllowedForHandler(e,t)?{canHandle:!0}:(a.debug(`blocked message ${e.action} from ${e.originPart} due to not allowed origin`),{canHandle:!1,reason:"origin not allowed"}):(a.debug(`message ${e.action} from ${e.originPart} has no handler`),{canHandle:!1,reason:"unknown action: "+e.action})}isOriginBlockedForHandler(e,t){return!(!t.blockedOrigins||!t.blockedOrigins.length)&&!(void 0!==e.originPart&&!t.blockedOrigins.includes(e.originPart))}isOriginAllowedForHandler(e,t){return!t.allowedOrigins||!t.allowedOrigins.length||!(void 0===e.originPart||!t.allowedOrigins.includes(e.originPart))}}const _=(e,t)=>{if(t instanceof Error)try{const e={};return Object.getOwnPropertyNames(t).forEach((n=>{e[n]=t[n]})),e}catch(e){}return t};const j=e=>new Promise((t=>{setTimeout((()=>t()),e)})),N=(e,t)=>new Promise(((n,o)=>{let i=!1,s=!1;e.then((e=>{i||(s=!0,n(e))})).catch((e=>{i||o(e)})),j(t).then((()=>{s||(i=!0,o("timeout"))}))}));class ${constructor(e){this.name=e}set(e){this.data=e}get(){if(void 0===this.data)throw`'${this.name} - data was not yet set`;return this.data}}const F=new $("sendMessageProvider"),G=(e,t)=>{return n=void 0,o=void 0,s=function*(){return F.get()(t,e)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s};var V=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};class U{constructor(e,t,n){var o,i,s;this.action=e,this.target=t,this.needsResponse=null===(o=null==n?void 0:n.needsResponse)||void 0===o||o,this.timeout=null!==(i=null==n?void 0:n.timeout)&&void 0!==i?i:3e3,this.autoRetry=null===(s=null==n?void 0:n.autoRetry)||void 0===s||s}createMessage(e){return{action:this.action,needsResponse:this.needsResponse,data:e}}send(e){var t;return V(this,void 0,void 0,(function*(){const i=null!==(t=H[this.action])&&void 0!==t?t:n.Debug;a.trace(`messageSender send was called for action ${this.action}`,e,o);const s=this.createMessage(e);a.log(i,`messageSender - sending message (${this.action})`,s,o);let r=0;for(;;)try{const e=G(s,this.target),t=yield N(e,this.timeout);return a.log(i,`messageSender - got result for message (${s.action})`,t,o),t}catch(e){if(!this.autoRetry){if(this.needsResponse)throw e;return}if(r++,r>5)throw a.debug(`messageSender failed for message (${s.action}), max retries reached.`,e,o),e;yield j(500),a.trace(`messageSender failed for message (${s.action}), retrying`,e,o)}throw"timeout"}))}}class q extends U{constructor(e,t,n){super(e,t,n)}send(e){const t=Object.create(null,{send:{get:()=>super.send}});return V(this,void 0,void 0,(function*(){return t.send.call(this,e)}))}}const J=(e,t,n)=>new q(e,t,n);const z=new q(D,R.Background,{needsResponse:!1}),K=e=>{return t=void 0,n=void 0,i=function*(){if(e.data)try{e.data=(e=>{if(void 0===e)return e;const t=JSON.stringify(e,_);return JSON.parse(t)})(e.data)}catch(e){}z.send(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i},Q=new U("getLoggerConfiguration",R.Background),X=()=>Q.send();class Y{constructor(e){this.subjectsToDeny=e}getFilterResult(t){return t.subject&&this.subjectsToDeny.indexOf(t.subject)>-1?e.Deny:e.Neutral}}const Z=new $("currentExtensionPartProvider");class ee{getFilterResult(t){return e.Deny}}class te{constructor(e){this.minLogLevel=e}getFilterResult(t){return t.level<this.minLogLevel?e.Deny:e.Neutral}}class ne extends te{constructor(e){super(e),this.minLogLevel=e}getFilterResult(t){return"undefined"==typeof window||window==(null===window||void 0===window?void 0:window.top)?e.Neutral:super.getFilterResult(t)}}const oe=["Content","Page","ContentMediator"],ie=e=>{const t=[];e.enabled||t.push(new ee);const n=Z.get();return oe.includes(n)&&t.push(new ne(e.minIframeLogLevel)),t.push(new te(e.minTopLogLevel)),t};new q(C,R.ActiveTabTopContent,{autoRetry:!1,needsResponse:!1});const se=new $("logToConsoleProvider");var re=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};const ae=(...e)=>re(void 0,void 0,void 0,(function*(){console.log(...e)}));class ce{constructor(e,t){this.logFilters=e,this.rateLimitEnforcer=t,this.didNotifyRateExceed=!1}handleRateLimitBlock(e){var t;if(this.didNotifyRateExceed)return;this.didNotifyRateExceed=!0;const o=((e,t)=>({level:n.Warn,message:"Rate limit blocked",time:e.time,data:{blockedLogMessage:e,rateLimit:t}}))(e,null===(t=this.rateLimitEnforcer)||void 0===t?void 0:t.rateLimit);this.logImpl(o)}log(e){t(this.logFilters,e)&&(!this.rateLimitEnforcer||this.rateLimitEnforcer.isAllowed()?this.logImpl(e):this.handleRateLimitBlock(e))}}class ue extends ce{constructor(){super(...arguments),this.currentLogs=[]}logImpl(e){return t=this,o=void 0,s=function*(){const t=e.subject?e.subject+" - ":"",o=`[${n[e.level]}]`;if(!this.currentLogs.includes(e.message)){this.currentLogs.push(e.message);try{const n=Z.get();yield((...e)=>re(void 0,void 0,void 0,(function*(){const t=se.get();t&&(yield t(...e))})))(`${new Date(e.time).toISOString()} [${n}] - ${o} ${t}${e.message}`,e.data)}catch(e){}const n=this.currentLogs.indexOf(e.message);this.currentLogs.splice(n,1)}},new((i=void 0)||(i=Promise))((function(e,n){function r(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(t,o||[])).next())}));var t,o,i,s}}const le=new $("logToEventCollectorProvider");class de extends ce{logImpl(e){return t=this,n=void 0,i=function*(){const t=e;t.extensionPart=Z.get();const n=le.get();n&&n(t)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}}const he=new $("currentLoggerConfigProvider");class ve{constructor(e){this.rateLimit=e,this.timesHistory=[]}addToHistory(e){for(this.timesHistory.push(e);this.timesHistory.length>this.rateLimit.maxTimesInInterval;)this.timesHistory.splice(0,1)}isAllowed(){const e=Date.now(),t=((e,t,n,o,i)=>e>=o&&void 0!==t&&n-t<i)(this.timesHistory.length,this.timesHistory[0],e,this.rateLimit.maxTimesInInterval,this.rateLimit.intervalInMs);return!t&&(this.addToHistory(e),!0)}}const fe=e=>{if(e)return new ve(e)},ge=e=>{he.set(e);const t=ie(e.console),n=fe(e.console.rateLimit),i=new ue(t,n),a=ie(e.remote);a.push(new Y([o]));const c=fe(e.remote.rateLimit),u=[i,new de(a,c)];var l;l=[],s.length=0,l.map((e=>s.push(e))),(e=>{r.length=0,e.map((e=>r.push(e)))})(u)},me=new $("currentMessageOriginProvider");var pe=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};class we{constructor(e,t,n){this.action=e,this.allowedOrigins=t,this.blockedOrigins=n}handle(e,t){return pe(this,void 0,void 0,(function*(){if(a.trace("messageHandler handle called",e,o),e.action!=this.action)throw"unsupported action: "+e.action+", expected: "+this.action;return this.handleImpl(t)}))}}class ye{constructor(e,t,n){this.action=e,this.allowedOrigins=t,this.blockedOrigins=n}handle(e,t){return pe(this,void 0,void 0,(function*(){if(a.trace("messageHandler handle called",e,o),e.action!=this.action)throw"unsupported action: "+e.action+", expected: "+this.action;const n=e.data;return this.handleImpl(n,t)}))}}const xe=new class{set(e){this.messageSender=e}get(){if(!this.messageSender)throw"message sender was not initalized";return this.messageSender}},be=e=>(a.trace("sendFromPageToContent",e,o),xe.get().send(e));const ke=(e,t)=>{return n=void 0,i=void 0,r=function*(){if(a.trace(`sendFromPage called (${t.action})`,t,o),e===R.OwnerContent)return be(t);{const o={action:O,data:{destination:e,message:n=t},needsResponse:n.needsResponse};return be(o)}var n},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,a)}c((r=r.apply(n,i||[])).next())}));var n,i,s,r},Pe=e=>null==e?void 0:e.data,Me=e=>e.message;class Se extends ye{constructor(e,t){super(e),this.handler=t}handleImpl(e,t){return this.handler(e,t)}}class Le{static empty(){return"ffffffffffffffffffffffffffffffff"}static newGuid(){return Le.newGuidByPattern("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static newGuidNoHyphens(){return Le.newGuidByPattern("xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx")}static newGuidByPattern(e){return e.replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}let Ee=0;const Ie=`testListenerAlive.${Le.newGuidNoHyphens()}`,Re=(e,t)=>new Promise((n=>{const o=`${Ie}.${Ee++}`;((e,t,n)=>{const o=new Se(e,(o=>{return i=void 0,s=void 0,a=function*(){clearTimeout(o),t.removeMessageHandler(e),n(!0)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,o)}c((a=a.apply(i,s||[])).next())}));var i,s,r,a}));t.addMessageHandler(o)})(o,e,n);const i=setTimeout((()=>{e.removeMessageHandler(o),n(!1)})),s=((e,t)=>({action:e,data:t,needsResponse:!1}))(o,i);t.send(s,!0)}));class Te{constructor(e){this.handleEvent=e}handle(e){this.handleEvent(e)}canHandle(e){return(e=>{const t=Pe(e);if(!t)return!1;const n=Me(t);return!!n&&!!n.action})(e)}}class Oe{constructor(e){this.communicationObject=e,this.communicationMessageHandlers=[]}start(){this.communicationObject.registerOnMessage((e=>this.handleMessageEvent(e)))}stop(){this.communicationObject.unregister()}reRegisterCommunication(){this.communicationObject.registerOnMessage((e=>this.handleMessageEvent(e)))}addCommunicationMessageHandler(e){this.communicationMessageHandlers.push(e)}handleMessageEvent(e){this.communicationMessageHandlers.map((t=>{try{t.canHandle(e)&&t.handle(e)}catch(n){a.debug("failed handling event",{event:e,handler:t,exception:n},o)}}))}}class Ce{constructor(e,t,n,o){this.responder=e,this.selfSender=t,this.messageRouter=n,this.communicationObject=o,this.communicationObjectConnector=new Oe(this.communicationObject)}start(){this.communicationObjectConnector.start();const e=new Te((e=>this.handleRegularRoutingMessage(e)));this.addCommunicationMessageHandler(e)}stop(){this.communicationObjectConnector.stop()}verifyCommunication(){return e=this,t=void 0,o=function*(){(yield Re(this.messageRouter,this.selfSender))||this.communicationObjectConnector.reRegisterCommunication()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}addCommunicationMessageHandler(e){this.communicationObjectConnector.addCommunicationMessageHandler(e)}handleRegularRoutingMessage(e){const t=Pe(e),n=Me(t);a.trace("CommunicationObjectMessageRouter - handling event",e,o),this.messageRouter.handleMessage(n,(e=>{this.sendResponse(t,e)}))}sendResponse(e,t){this.responder.sendResponse(e,t)}}class De{constructor(e,t){this.postMessageFn=e,this.responseMessageHandler=t,this.runningMessageId=0}send(e,t=!1){return n=this,i=void 0,r=function*(){a.trace("CommunicationObjectMessageSender send called",e,o);const n=e;n.originPart=me.get();const i=this.createCommunictionObjectMessage(n);if(a.trace("CommunicationObjectMessageSender send wrapped message",i,o),!t)return new Promise(((e,t)=>{this.responseMessageHandler.waitForResponse(i.id,e,t),this.sendRaw(i)}));this.sendRaw(i)},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,a)}c((r=r.apply(n,i||[])).next())}));var n,i,s,r}sendResponse(e,t){var n;if((null===(n=e.message)||void 0===n?void 0:n.action)==B)return;const o={messageId:e.id,resultData:t},i={action:B,needsResponse:!1,data:o,originPart:me.get()};this.send(i,!0)}sendRaw(e){if(a.trace("CommunicationObjectMessageSender sendSync",e),!this.postMessageFn)throw"postMessageFn object wasn't initialized";this.postMessageFn(e)}createCommunictionObjectMessage(e){return{id:e.action+(new Date).getTime()+"_"+this.runningMessageId++,message:e}}}const Ae=B;class Be extends ye{constructor(){super(Ae),this.pendingRequests={}}handleImpl(e){return t=this,n=void 0,i=function*(){if(void 0===this.pendingRequests[e.messageId])return;const t=this.pendingRequests[e.messageId];delete this.pendingRequests[e.messageId],e.resultData.success?t.resolve(e.resultData.result):t.reject(e.resultData.error)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}waitForResponse(e,t,n){this.pendingRequests[e]={resolve:t,reject:n}}}const He=(e,t)=>{const n=((e,t)=>{const n=t.getMessageHandler(Ae),o=null!=n?n:new Be;n||t.addMessageHandler(o);const i=new De(e.postMessage,o),s=new De(e.postToSelf,o),r=new Ce(i,s,t,e);return r.start(),{routerConnector:r,sender:i,selfSender:s}})(((e,t,n)=>{let o;const i=e=>{o(e.detail)},s=(t,n)=>{const o=(i={data:n},"undefined"!=typeof cloneInto?cloneInto(i,e):i);var i;const s=new CustomEvent(t,{detail:o});e.dispatchEvent(s)};return{postMessage:e=>{s(n,e)},postToSelf:e=>{s(t,e)},registerOnMessage:n=>{e.removeEventListener(t,i),n&&(o=n,e.addEventListener(t,i))},unregister:()=>{e.removeEventListener(t,i)}}})(e,"wmContentToPage","wmPageToContent"),t);return xe.set(n.sender),n},We=new class{constructor(e){this.logger=e}getAllLogs(e=n.Debug){return this.logger.getHistory(e)}getLogger(){return this.logger}}(a);class _e{constructor(){this.log=We}}class je{constructor(e){this.name=e,this.epoch=(new Date).getTime(),this.previousEventTime=this.epoch}silly(e,t){this.log(e,n.Silly,t)}verbose(e,t){this.log(e,n.Verbose,t)}trace(e,t){this.log(e,n.Verbose,t)}debug(e,t){this.log(e,n.Debug,t)}info(e,t){this.log(e,n.Info,t)}log(e,t,n){const o=(new Date).getTime(),i=o-this.epoch,s=Math.round(performance.now()),r=o-this.previousEventTime;this.previousEventTime=o;const c=`${this.name} - ${e}`,u={timeSinceLoggerStarted:i,timeSincePageLoad:s,timeSincePreviousEvent:r},l=Object.assign({},u,n);a.log(t,c,l,"Performance")}}var Ne;!function(e){e[e.TabError=1]="TabError",e[e.PageError=2]="PageError",e[e.LibError=3]="LibError",e[e.TimeOut=4]="TimeOut"}(Ne||(Ne={}));var $e=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};const Fe=(e,t,n,o,i)=>$e(void 0,void 0,void 0,(function*(){return((e,t,n,o,i)=>$e(void 0,void 0,void 0,(function*(){for(let i=0;i<o;i++){const o=yield e();if(n(o))return o;yield j(t)}return i})))((()=>{return s=e,t=void 0,n=void 0,i=function*(){return s()},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i,s}),t,n,o,i)}));const Ge=e=>{try{return e._walkMe.getUserGuid()}catch(t){return Ve(e)}},Ve=e=>{try{return e._walkmeInternals.sdk.settings.getSystemId()}catch(e){return}};const Ue=new class extends we{constructor(e){super("getWalkMePageDetails"),this.window=e}handleImpl(){return e=this,t=void 0,o=function*(){if(!this.window._walkmeInternals||!this.window._walkMe)return{fetchDataError:Ne.PageError};try{const e=this.window._walkmeInternals.removeWalkMeReason,t=this.window._walkmeInternals.ctx.get("EndUsersManager").isWalkMeGeneratedEndUserType();let n=this.window._walkMe.getEndUserGuid();const o=this.window._walkMe.getEnvId(),i=Ge(this.window);return n=n&&t?"Auto Generated":n,{data:{endUserId:n,walkmeRemoveReason:e,loadedEnv:o,loadedGuid:i}}}catch(e){return{fetchDataError:Ne.LibError}}},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}}(window),qe=new $("loadDecisionProvider");const Je=new class extends we{constructor(){super("getIsSnippetExistsAndShouldLoad")}handleImpl(){return e=this,t=void 0,o=function*(){const e=qe.get();return e?{data:{shouldLoad:!e.resumeSiteSnippet,snippetExists:e.snippetBlockDecision.waitForSiteSnippetBlock,injectedPackage:e.packageToLoad}}:{fetchDataError:Ne.PageError}},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}};const ze=new class extends ye{constructor(){super("updateLoggerConfig")}handleImpl(e){return t=this,n=void 0,i=function*(){ge(e)},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i}};const Ke=[Je,Ue,ze,new class extends we{constructor(e){super("getSystemId"),this.window=e}handleImpl(){return e=this,t=void 0,o=function*(){return Ge(this.window)},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}}(window)],Qe=new $("trustedTypesPolicyProvider");const Xe=(e,t)=>t?t.createScriptURL(e):e,Ye=new U("getPackages",R.OwnerContent);const Ze=(e,t)=>{return n=void 0,o=void 0,s=function*(){return a.debug("waitForSnippetBlock - Should wait for block without timeout"),t=t||10,((e,t)=>$e(void 0,void 0,void 0,(function*(){return new Promise((n=>{const o=()=>{e()?n():setTimeout(o,t)};o()}))})))((e=>()=>{var t;const n=!!(null===(t=e._walkmeInternals)||void 0===t?void 0:t.blocked);return a.debug(`snippetBlockedChecker - isSnippetBlocked: ${n}`),n})(e),t)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s},et=e=>{e._walkmeExtension||(e._walkmeExtension={})},tt=(e,t,n)=>{et(e),e._walkmeExtension[t]=n};const nt=new U("getNonceValue",R.OwnerContent);const ot=new class{constructor(e){this.getLogic=e,this.wasSet=!1}get(){return e=this,t=void 0,o=function*(){if(!this.wasSet)try{const e=yield this.getLogic();this.data=e,this.wasSet=!0}catch(e){}return this.data},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}}((()=>{return e=void 0,t=void 0,o=function*(){return nt.send()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o})),it=(new U(A,R.Background,{timeout:1e3,autoRetry:!1}),new U(A,R.Background,{timeout:1e3})),st=new U("getContentStartTime",R.OwnerContent),rt={};rt.Page=R.OwnerContent,rt.Content=R.Background;var at=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};const ct=new class{constructor(){this.subscribersByEventName={}}on(e,t){return void 0===this.subscribersByEventName[e]&&(this.subscribersByEventName[e]=[]),this.subscribersByEventName[e].push(t),()=>{this.off(e,t)}}off(e,t){if(void 0===this.subscribersByEventName[e])return;const n=this.subscribersByEventName[e],o=n.indexOf(t);-1!=o&&(n.splice(o,1),0==n.length&&delete this.subscribersByEventName[e])}raiseEvent(e,t,n){return at(this,void 0,void 0,(function*(){return this.handleBubbling(e,t),this.handleRaise(e,t,n)}))}handleBubbling(e,t){try{((e,t)=>{const n=(e=>{if(void 0!==rt[e])return rt[e]})(Z.get());var o;void 0!==n&&(o={eventName:e,eventData:t},J("raiseEvent",n).send(o))})(e,t)}catch(e){}}handleRaise(e,t,n){return at(this,void 0,void 0,(function*(){if(void 0===this.subscribersByEventName[e])return;const o=this.subscribersByEventName[e];for(let e=0;e<o.length;e++){const i=o[e];try{const e=i(t,n);e&&e.promiseToWait&&(yield e.promiseToWait)}catch(e){}}}))}},ut=ct,lt=ct,dt=e=>{const t=e.match(/\/walkme_([a-f0-9]+)(_https)?.js/);if(t)return t[1]},ht=e=>void 0!==e.UserGuid?e.UserGuid:dt(e.Snippet);const vt=(e,t)=>({snippetBlockDecision:{waitForSiteSnippetBlock:e,shouldRemoveSnippetBlockers:!(null==t?void 0:t.SupportsSnippetBlockIgnore)},packageToLoad:t,removeSiteSnippet:!!t&&e,resumeSiteSnippet:!t&&e});const ft=e=>{const t=e.src;if(t)return dt(t)},gt=e=>{const t=e.innerHTML;if(!(t.length>350))return dt(t)},mt=e=>{const t=function(e){return!!e._walkmeInternals}(e);return!!t||!!(e=>{var t;return(e=>{for(const t of e){const e=ft(t);if(e)return e}for(const t of e){const e=gt(t);if(e)return e}})((t=e.document,Array.from(t.getElementsByTagName("script"))))})(e)},pt={wasAutoDetectCalculated:!1,autoDetectedResult:!1,timeAlreadyWaited:0};var wt=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};const yt=e=>wt(void 0,void 0,void 0,(function*(){return pt.wasAutoDetectCalculated||(yield xt(e),pt.wasAutoDetectCalculated=!0,pt.autoDetectedResult=mt(e)),pt.autoDetectedResult})),xt=e=>wt(void 0,void 0,void 0,(function*(){yield(e=>{return t=void 0,n=void 0,i=function*(){return new Promise((t=>{const n=e.document;if("loading"!==n.readyState)t();else{const o=()=>{t(),n.removeEventListener("DOMContentLoaded",o,!0),e.removeEventListener("load",o,!0)};n.addEventListener("DOMContentLoaded",o,!0),e.addEventListener("load",o,!0)}}))},new((o=void 0)||(o=Promise))((function(e,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,a)}c((i=i.apply(t,n||[])).next())}));var t,n,o,i})(e)}));var bt,kt;!function(e){e[e.NoSnippetInSite=0]="NoSnippetInSite",e[e.SnippetInSite=1]="SnippetInSite",e[e.AutoDetect=2]="AutoDetect",e[e.SnippetInSiteTimeout=3]="SnippetInSiteTimeout"}(bt||(bt={})),function(e){e[e.OnlyTop=1]="OnlyTop",e[e.TopAndCdIframes=2]="TopAndCdIframes"}(kt||(kt={}));const Pt=(e,t)=>{return n=void 0,o=void 0,s=function*(){switch(e.SnippetDetect){case bt.NoSnippetInSite:return!1;case bt.SnippetInSite:return!0;case bt.SnippetInSiteTimeout:return yield(e=>wt(void 0,void 0,void 0,(function*(){if(pt.wasAutoDetectCalculated){const e=pt.timeAlreadyWaited>=1e3;if(pt.autoDetectedResult||e)return pt.autoDetectedResult}const t=1e3-pt.timeAlreadyWaited;yield xt(e),a.debug(`autoDetectSnippetWithTimeout - Should wait for site snippet existence with timeout of ${t}ms, with intervals of 200ms`);const n=Math.floor(t/200);return pt.autoDetectedResult=yield Fe((()=>mt(e)),200,(e=>e),n,!1),pt.timeAlreadyWaited+=t,pt.wasAutoDetectCalculated=!0,pt.autoDetectedResult})))(t);case bt.AutoDetect:return yield yt(t)}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s};const Mt=(e,t)=>{return n=void 0,o=void 0,s=function*(){const n=yield((e,t)=>{return n=void 0,o=void 0,s=function*(){return!!e.IsStronger||!(yield Pt(e,t))},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s})(e,t);if(!n)return;let o;return o=!e.SupportsSnippetBlockIgnore&&(yield Pt(e,t)),vt(o,e)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s};const St=(e,t)=>{return n=void 0,o=void 0,s=function*(){const n=yield((e,t,n)=>{return o=void 0,i=void 0,r=function*(){return yield Fe((()=>Ve(e)),8e3,(e=>null!=e),5,void 0)},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,a)}c((r=r.apply(o,i||[])).next())}));var o,i,s,r})(e);null==n?Lt(e,t,4e4):t.UserGuid&&n!=t.UserGuid&&Et(e,t,n)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}c((s=s.apply(n,o||[])).next())}));var n,o,i,s},Lt=(e,t,n)=>{const o=(e=>{var t;try{return null===(t=null==e?void 0:e._walkmeInternals)||void 0===t?void 0:t.removeWalkMeReason}catch(e){return}})(e),s=(e=>{var t;try{return null===(t=null==e?void 0:e._walkmeInternals)||void 0===t?void 0:t.snippetLog}catch(e){return}})(e),r=(e=>{try{return!!(null==e?void 0:e._walkMe)}catch(e){return!1}})(e),c=(e=>{var t;try{return null===(t=null==e?void 0:e._walkMe)||void 0===t?void 0:t.getUserGuid()}catch(e){return}})(e),u=(e=>{var t;try{return null===(t=null==e?void 0:e._walkmeInternals)||void 0===t?void 0:t.isVisibleSinceLoad}catch(e){return}})(e),l=(e=>{var t,n;try{return null===(n=null===(t=null==e?void 0:e._walkmeInternals)||void 0===t?void 0:t.timing)||void 0===n?void 0:n.delta}catch(e){return}})(e),d=(e=>{var t,n,o;try{return!!(null===(o=null===(n=null===(t=null==e?void 0:e._walkmeInternals)||void 0===t?void 0:t.timing)||void 0===n?void 0:n.map)||void 0===o?void 0:o.walkmeReady)}catch(e){return!1}})(e),h={injectedPackage:t,removeWalkMeReason:o,timeWaited:n,host:e.location.host,snippetLogs:s,hasWalkMeOnPage:r,systemIdFromWalkMeObject:c,wasWalkMeReadyRaised:d,isVisibleSinceLoad:u,timingDelta:l};a.warn("WalkMe was injected but not loaded",h,i)},Et=(e,t,n)=>{const o={injectedPackage:t,runningSystemId:n,host:e.location.host};a.warn("WalkMe was injected but a different system was loaded",o,i)},It=new U("getLanguage",R.OwnerContent);const Rt=()=>{return e=void 0,t=void 0,o=function*(){return yield It.send()},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o};class Tt{constructor(e){this.doc=e,this.callbacks=[],this.observer=new MutationObserver((e=>{e.some((e=>Array.from(e.removedNodes).some((e=>e.toString().includes("DocumentType")))))&&this.runRegisteredCallbacks()}))}runRegisteredCallbacks(){this.callbacks.forEach((e=>{try{e()}catch(e){}}))}start(){this.observer.disconnect(),this.observer.observe(this.doc,{childList:!0})}stop(){this.observer.disconnect()}addListener(e){this.removeListener(e),this.callbacks.push(e)}removeListener(e){this.callbacks=this.callbacks.filter((t=>e!=t))}}let Ot;var Ct=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};class Dt{constructor(e,t){this.win=e,this.pageMessageRouterConnector=t}start(){var e;return Ct(this,void 0,void 0,(function*(){const t=this.win.location.host,n=new je(`web accessible runner - ${t}`);var o,i;o=this.pageMessageRouterConnector.messageRouter,i=o,Ke.map((e=>{try{i.addMessageHandler(e)}catch(e){}}));const s=yield(r=void 0,c=void 0,u=void 0,l=function*(){return yield Ye.send()},new(u||(u=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function o(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof u?i:new u((function(e){e(i)}))).then(n,o)}i((l=l.apply(r,c||[])).next())})));var r,c,u,l;n.trace("after get packages");const d=yield(h=s,v=this.win,function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){for(let e=0;e<h.length;e++){const t=h[e],n=yield Mt(t,v);if(n)return n}const e=yield yt(v);return vt(e)})));var h,v,f,g,m;if(a.debug(`WebAccessibleWalkMeLoadingRunner - loadDecision: ${JSON.stringify(d)}`),this.saveLoadDecision(d),a.debug(`Load Decision, should load: ${!!d.packageToLoad} `,d),n.trace("after load decision"),d.snippetBlockDecision.waitForSiteSnippetBlock&&(n.debug("waiting for site snippet block"),yield Ze(this.win),n.trace("after snippet block")),d.snippetBlockDecision.shouldRemoveSnippetBlockers&&this.removeSnippetBlockers(document),d.removeSiteSnippet&&(yield(e=>function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){return new Promise((t=>{if(e._makeTutorial&&e._makeTutorial.removeWalkMe){const n={callback:()=>{a.debug("removeSiteSnippet - Original snippet has been removed"),t()}};e._makeTutorial.removeWalkMe("master extension removal",n)}else a.verbose("removeSiteSnippet - WalkMe was not found on site"),t()}))})))(this.win),n.trace("after site snippet remove")),d.packageToLoad){!!(null===(e=d.packageToLoad.Configuration)||void 0===e?void 0:e.rebindCommunicationOnDocumentWrite)&&(g=this.win.document,m=()=>this.pageMessageRouterConnector.verifyCommunication(),Ot||(Ot=new Tt(g),Ot.start()),Ot.addListener(m)),yield(f=d.packageToLoad,function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){const e=ht(f);if(!e)return;const t=((e,t)=>void 0!==e.EnvironmentId?e.EnvironmentId:e.Snippet.includes(t+"/test/")?3:0)(f,e),n={uid:e,env:t};return lt.raiseEvent(I,n)})));const o=this.createAndStoreTrustedTypesPolicy(),i=yield ot.get(),s=yield st.send();yield this.handlePackageInjection(d.packageToLoad,o,i,s);const r={injectedPackage:d.packageToLoad,host:t,totalTimeTaken:Date.now()-s};n.info("after package injection",r),St(this.win,d.packageToLoad)}else d.resumeSiteSnippet&&((e=>{!function(e,t,n,o){new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){e._walkmeInternals&&e._walkmeInternals.continueLoad?e._walkmeInternals.continueLoad():e.WalkmeSnippet&&e.WalkmeSnippet()}))})(this.win),n.debug("after continue snippet"))}))}removeSnippetBlockers(e){return Ct(this,void 0,void 0,(function*(){(e=>{delete e.dontLoadTriangle,delete e.extensionIsBlockingSnippet})(e)}))}handlePackageInjection(e,t,n,o){return Ct(this,void 0,void 0,(function*(){return this.exposeDataToPlayer(e,!!t,n,o,Date.now()),((e,t,n,o)=>{return i=void 0,s=void 0,a=function*(){const i=window.document.createElement("script");((e,t,n)=>{e.src=Xe(t,n)})(i,e.Snippet,t),((e,t)=>{t&&(e.crossOrigin="anonymous")})(i,e.SetAnonymousCors),((e,t)=>{t&&(e.integrity=t)})(i,e.IntegrityHash),((e,t)=>{t&&e.setAttribute("nonce",t)})(i,n),((e,t={})=>{for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n))try{const o=t[n];e.setAttribute(n,o)}catch(e){}})(i,o),window.document.head.appendChild(i)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(n,o)}c((a=a.apply(i,s||[])).next())}));var i,s,r,a})(e,t,n,{extensionsnippet:"true"})}))}exposeDataToPlayer(e,t,n,o,i){return Ct(this,void 0,void 0,(function*(){const s=this.win;var r,a;((e,t)=>{et(e),e._walkmeExtension.injectedGuid=t})(s,ht(e)),a=t,et(r=s),r._walkmeExtension.useTrustedTypePolicy=a.toString(),((e,t)=>{et(e),e._walkmeExtension.nonceValue=t})(s,n),(e=>{e!==e.top&&(e.walkme_load_in_iframe=!0)})(s),tt(s,"getLanguage",Rt),((e,t,n)=>{et(e);const o="meInjectingSnippet",i="meDocumentStart",s={map:{},list:[],delta:[]};s.map[i]=t,s.list.push({name:i,time:t}),s.delta.push({name:i,time:0}),s.map[o]=n,s.list.push({name:o,time:n}),s.delta.push({name:o,time:n-t}),e._walkmeExtension.timing=s,e._walkmeInternals=e._walkmeInternals||{},e._walkmeInternals.timing=s})(s,o,i),((e,t)=>{et(e),e._walkmeExtension.extVersion=t.version,e._walkmeExtension.extensionEndUser=t.endUser,e._walkmeExtension.installGuid=t.installGuid,e._walkmeExtension.extensionGuid=t.extensionGuid,e._walkmeExtension.installMode=t.installMode})(s,yield it.send())}))}saveLoadDecision(e){qe.set(e)}createAndStoreTrustedTypesPolicy(){const e=(e=>{let t;return e.trustedTypes&&e.trustedTypes.createPolicy&&(t=e.trustedTypes.createPolicy("walkme-extension",{createScriptURL:e=>e,createHTML:e=>e,createScript:e=>e})),t})(window);return Qe.set(e),e}}class At{constructor(e){this.messageRouter=e}onMessage(e,t){const n=new Se(e,t);this.messageRouter.addMessageHandler(n)}sendMessage(e,t,n,o){const i={needsResponse:!1,autoRetry:null==o?void 0:o.autoRetry,timeout:null==o?void 0:o.timeout};new q(e,t,i).send(n)}sendMessageWithResult(e,t,n,o){const i={needsResponse:!0,autoRetry:null==o?void 0:o.autoRetry,timeout:null==o?void 0:o.timeout};return new q(e,t,i).send(n)}}const Bt=J("isFeatureEnabled",R.Background),Ht={isFeatureEnabled:e=>Bt.send(e)};var Wt,_t;_t=function*(){const e=new W,t=He(window,e);var n,o,i,s,r;yield(n={extensionPart:"Page",fetchLogConfig:X,logToEventCollector:K,sendMessageFunction:ke},o=void 0,i=void 0,s=void 0,r=function*(){var e;Z.set(n.extensionPart),me.set(null!==(e=n.messageOrigin)&&void 0!==e?e:n.extensionPart),F.set(n.sendMessageFunction);const t=yield n.fetchLogConfig();ge(t),le.set(n.logToEventCollector),se.set(n.logToConsole||ae)},new(s||(s=Promise))((function(e,t){function n(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,a)}c((r=r.apply(o,i||[])).next())})));const c=(u=window,{communication:new At(e),eventsManager:ut,featuresManager:Ht,pageDataExposer:{exposeWalkMeExtension:(e,t)=>tt(u,e,t),exposeWalkMeInternals:(e,t)=>((e,t,n)=>{(e=>{e._walkmeInternals||(e._walkmeInternals={})})(e),e._walkmeInternals[t]=n})(u,e,t)}});var u;[new T,new E].forEach((e=>{try{e.init(c)}catch(e){a.warn("Failed to init web-accessible module part",e)}})),a.debug(`WalkMe Loading - Web Accessible started (${document.location.host})`),new Dt(window,t.routerConnector).start(),window._wmExtensionApi=new _e,a.debug("WalkMe Loading - End of Web Accessible")},new((Wt=void 0)||(Wt=Promise))((function(e,t){function n(e){try{i(_t.next(e))}catch(e){t(e)}}function o(e){try{i(_t.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof Wt?i:new Wt((function(e){e(i)}))).then(n,o)}i((_t=_t.apply(void 0,[])).next())}))})();